# Project Structure

‚îú‚îÄ üìÅ js
  ‚îî‚îÄ storage.js
  ‚îî‚îÄ storage.test.js
  ‚îî‚îÄ statistics.js
  ‚îî‚îÄ random.test.js
  ‚îî‚îÄ random.js
  ‚îî‚îÄ player.js
  ‚îî‚îÄ network.js
  ‚îî‚îÄ main.js
  ‚îî‚îÄ localization.test.js
  ‚îî‚îÄ localization.js
  ‚îî‚îÄ game.js
  ‚îî‚îÄ utils.test.js
  ‚îî‚îÄ utils.js
  ‚îî‚îÄ ui.js
  ‚îî‚îÄ tutorial.js
  ‚îî‚îÄ tournaments.js
  ‚îî‚îÄ config.js
  ‚îî‚îÄ board.js
  ‚îî‚îÄ audio.js
  ‚îî‚îÄ achievements.js
‚îú‚îÄ üìÅ src
  ‚îî‚îÄ style.css
  ‚îî‚îÄ index.html
  ‚îî‚îÄ game.js
‚îú‚îÄ üìÅ css
  ‚îî‚îÄ style.css
  ‚îî‚îÄ animations.css
‚îú‚îÄ üìÅ assets
  ‚îú‚îÄ üìÅ tokens
    ‚îî‚îÄ en.json
    ‚îî‚îÄ de.json
    ‚îî‚îÄ es.json
    ‚îî‚îÄ zh.json
    ‚îî‚îÄ ru.json
    ‚îî‚îÄ README.md
    ‚îî‚îÄ ko.json
    ‚îî‚îÄ ja.json
    ‚îî‚îÄ fr.json
  ‚îú‚îÄ üìÅ sounds
    ‚îî‚îÄ README.md
  ‚îú‚îÄ üìÅ brands
    ‚îî‚îÄ README.md
‚îî‚îÄ test.html
‚îî‚îÄ sw.js
‚îî‚îÄ stylelint.config.js
‚îî‚îÄ README.md
‚îî‚îÄ README.html
‚îî‚îÄ package.json
‚îî‚îÄ manifest.json
‚îî‚îÄ index.html
‚îî‚îÄ .stylelintrc.json
‚îî‚îÄ .htaccess

# Project Files

- c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\README.md
- c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\src\index.html
- c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\.github\workflows\gh-pages.yml
- c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\js\game.js
- c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\sw.js
- c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\js\ui.js

## c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\README.md
```
# Monopoly Russia Prototype

–ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–π –∏–≥—Ä—ã, –≤–¥–æ—Ö–Ω–æ–≤–ª—ë–Ω–Ω–æ–π "–ú–æ–Ω–æ–ø–æ–ª–∏–µ–π" —Å —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä–Ω–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–æ–π. –ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∫–∞–∫ –ø—Ä–æ—Ç–æ—Ç–∏–ø —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–æ–¥–æ–º.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
npm install
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000 –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
npm run build     # –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
npm run serve     # –ó–∞–ø—É—Å–∫ production –≤–µ—Ä—Å–∏–∏
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
‚îú‚îÄ‚îÄ src/                    # –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.html         # Development –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ index.prod.html    # Production —à–∞–±–ª–æ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ style.css          # –°—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ game.js            # –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ performance-report.md
‚îú‚îÄ‚îÄ dist/                  # –°–æ–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.html         # –ú–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ style.min.css      # –ú–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ game.min.js        # –ú–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JS
‚îú‚îÄ‚îÄ build.js               # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ .htaccess             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Apache
‚îî‚îÄ‚îÄ index.html            # –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```

## üéÆ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ** —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏ –∏ –ª–æ–∫–∞—Ü–∏—è–º–∏
- **–ü–æ–∫—É–ø–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** –∏ —Å–∏—Å—Ç–µ–º–∞ –∞—Ä–µ–Ω–¥—ã
- **–ö–∞—Ä—Ç–æ—á–∫–∏ —à–∞–Ω—Å–∞** —Å —Ä–æ—Å—Å–∏–π—Å–∫–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥** —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º DOM –∏ –ø–ª–∞–≤–Ω—ã–º–∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** —Å –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ —Å–∂–∞—Ç–∏–µ–º

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ù–∞—Ç–∏–≤–Ω—ã–π JavaScript –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DOM –æ–ø–µ—Ä–∞—Ü–∏–∏
- CSS –∞–Ω–∏–º–∞—Ü–∏–∏ —Å –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º
- –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏ —Å –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ —á–µ—Ä–µ–∑ .htaccess
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ ~40%

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- –†–∞–∑–º–µ—Ä bundle: ~2.8KB (–º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~100ms
- DOM –∑–∞–ø—Ä–æ—Å—ã: 1-2 –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–µ
- –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

## üîß –ö–æ–º–∞–Ω–¥—ã NPM

- `npm run start` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç dev —Å–µ—Ä–≤–µ—Ä–∞
- `npm run dev` - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ—Ä—Ç 8000)
- `npm run build` - –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `npm run serve` - Production —Å–µ—Ä–≤–µ—Ä
- `npm run optimize` - –°–±–æ—Ä–∫–∞ + –∞–Ω–∞–ª–∏–∑
- `npm run analyze` - –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ bundle

## üåü –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º
- –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- –¢—É—Ä–Ω–∏—Ä–Ω—ã–π —Ä–µ–∂–∏–º  
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–±—ã—Ç–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏
- Progressive Web App –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
```

## c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\src\index.html
```
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monopoly Russia (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)</title>
    <meta name="description" content="–ë—ã—Å—Ç—Ä–∞—è –±—Ä–∞—É–∑–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–π –∏–≥—Ä—ã –ú–æ–Ω–æ–ø–æ–ª–∏—è —Å —Ä–æ—Å—Å–∏–π—Å–∫–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π. –ò–≥—Ä–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ!">
    <meta name="theme-color" content="#007bff">
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="../icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="../icons/icon-192x192.png">
    <link rel="canonical" href="https://yourdomain.com/">
    <meta property="og:title" content="–ú–æ–Ω–æ–ø–æ–ª–∏—è –†–æ—Å—Å–∏—è ‚Äî –±—Ä–∞—É–∑–µ—Ä–Ω–∞—è –Ω–∞—Å—Ç–æ–ª—å–Ω–∞—è –∏–≥—Ä–∞">
    <meta property="og:description" content="–ë—ã—Å—Ç—Ä–∞—è –±—Ä–∞—É–∑–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–π –∏–≥—Ä—ã –ú–æ–Ω–æ–ø–æ–ª–∏—è —Å —Ä–æ—Å—Å–∏–π—Å–∫–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π. –ò–≥—Ä–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ!">
    <meta property="og:image" content="../icons/icon-512x512.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/">
    <meta name="twitter:card" content="summary_large_image">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXX-X"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-XXXXXXX-X');
    </script>
    <!-- Yandex.Metrica -->
    <script type="text/javascript" >
      (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
      })(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
      ym(XXXXXXX, "init", {
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true,
          webvisor:true
      });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/XXXXXXX" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "–í–ê–®_API_KEY",
        authDomain: "–í–ê–®_–î–û–ú–ï–ù.firebaseapp.com",
        projectId: "–í–ê–®_PROJECT_ID",
        appId: "–í–ê–®_APP_ID"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
</head>
<body>
    <div id="game-container">
        <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
        <div id="board" class="board"></div>

        <!-- –ü–∞–Ω–µ–ª—å –∏–≥—Ä–æ–∫–æ–≤ -->
        <div id="players-panel"></div>

        <!-- –¢–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ -->
        <div class="current-player">
            <div class="player-info">
                <img class="player-token" src="" alt="–§–∏—à–∫–∞">
                <span class="player-name"></span>
            </div>
        </div>

        <!-- –ü–æ–≥–æ–¥–∞ –∏ —Å–æ–±—ã—Ç–∏—è -->
        <div id="current-weather"></div>
        <div id="current-events"></div>

        <!-- –ü–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
        <div id="achievements-panel"></div>

        <!-- –ö–Ω–æ–ø–∫–∏ —Ç—É—Ä–Ω–∏—Ä–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–π -->
        <div id="actions-panel">
            <button id="start-tournament-btn">–¢—É—Ä–Ω–∏—Ä</button>
            <button id="build-improvement-btn">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ</button>
        </div>

        <!-- –ß–∞—Ç -->
        <div id="chat">
            <div id="chat-messages" style="height:120px;overflow-y:auto;"></div>
            <input id="chat-input" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button id="send-message-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ -->
        <div id="card-modal" class="modal hidden">
            <div class="modal-content">
                <h2 id="card-title"></h2>
                <p id="card-text"></p>
                <button onclick="document.getElementById('card-modal').classList.add('hidden')">OK</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ -->
        <div id="modal-overlay" class="modal hidden">
            <div class="modal-content">
                <h2 id="modal-title"></h2>
                <div id="modal-content"></div>
                <button id="modal-confirm">–ö—É–ø–∏—Ç—å</button>
                <button id="modal-cancel">–ê—É–∫—Ü–∏–æ–Ω</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É–∫—Ü–∏–æ–Ω–∞ -->
        <div id="auction-modal" class="modal hidden">
            <div class="modal-content">
                <h2>–ê—É–∫—Ü–∏–æ–Ω: <span id="auction-property"></span></h2>
                <div>
                    <span>–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞: <span id="current-bid-amount">0</span></span><br>
                    <span>–£—á–∞—Å—Ç–Ω–∏–∫: <span id="current-bidder">-</span></span><br>
                    <span>–í—Ä–µ–º—è: <span id="auction-time">0</span> —Å–µ–∫</span>
                </div>
                <input id="bid-amount" type="number" min="1" placeholder="–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞">
                <button id="place-bid-btn">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
                <button id="pass-bid-btn">–ü–∞—Å</button>
            </div>
        </div>
        <div id="toast" class="toast hidden"></div>
        <button id="google-signin-btn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
        <button id="signout-btn">–í—ã–π—Ç–∏</button>
        <button id="theme-toggle-btn">üåô/‚òÄÔ∏è –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JS (–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!) -->
    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/board.js"></script>
    <script src="../js/player.js"></script>
    <script src="../js/game.js"></script>
    <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Ç—É—Ä–Ω–∏—Ä–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–π
    document.addEventListener('DOMContentLoaded', function() {
        const tournamentBtn = document.getElementById('start-tournament-btn');
        if (tournamentBtn) tournamentBtn.onclick = () => game.startTournament({ type: 'elimination', maxRounds: 5 });
        const improvementBtn = document.getElementById('build-improvement-btn');
        if (improvementBtn) improvementBtn.onclick = () => {
            const pos = game.players[game.currentPlayerIndex].position;
            game.players[game.currentPlayerIndex].addImprovement(pos);
        };
    });
    if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('../sw.js');
  });
}
    document.getElementById('google-signin-btn').onclick = function() {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then(result => {
          const user = result.user;
          alert('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: ' + user.displayName);
          // user.uid, user.email, user.photoURL
        })
        .catch(error => {
          alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
        });
    };
    document.getElementById('signout-btn').onclick = function() {
      firebase.auth().signOut();
    };
    // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
    const themeBtn = document.getElementById('theme-toggle-btn');
    function applyTheme(theme) {
      document.body.classList.toggle('theme-light', theme === 'light');
      localStorage.setItem('theme', theme);
    }
    themeBtn.onclick = function() {
      const isLight = document.body.classList.toggle('theme-light');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    };
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) applyTheme(savedTheme);
    </script>
</body>
</html> 
```

## c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\.github\workflows\gh-pages.yml
```
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm install
      - run: npm run build
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist 
```

## c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\js\game.js
```
/**
 * –£–ª—É—á—à–µ–Ω–Ω—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –∏–≥—Ä—ã
 * –£–ø—Ä–∞–≤–ª—è–µ—Ç –∏–≥—Ä–æ–≤—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º, —Ö–æ–¥–∞–º–∏ –∏–≥—Ä–æ–∫–æ–≤ –∏ –æ–±—â–µ–π –ª–æ–≥–∏–∫–æ–π –∏–≥—Ä—ã
 */

import { getText } from './localization.js';
import { formatMoney, generateId } from './utils.js';
import { saveToStorage, loadFromStorage } from './storage.js';
import { randomChoice, rollDice } from './random.js';
// TODO: escapeHTML, showToast, randomInt, passedStart ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å/–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ

// –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
const escapeHTML = (str) => String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
const showToast = (msg) => alert(msg); // –í—Ä–µ–º–µ–Ω–Ω–æ alert
const passedStart = (oldPos, newPos) => newPos < oldPos;

class Game {
    constructor() {
        this.players = [];
        this.currentPlayerIndex = 0;
        this.gameState = 'waiting'; // waiting, playing, paused, finished
        this.turnNumber = 0;
        this.dice = { dice1: 0, dice2: 0, total: 0, isDouble: false };
        this.auction = null;
        this.chat = [];
        this.settings = { ...CONFIG.DEFAULT_SETTINGS };
        this.gameHistory = [];
        
        // –ù–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
        this.weather = { type: 'sunny', duration: 0, effects: {} };
        this.economicEvent = null;
        this.culturalEvent = null;
        this.tradeOffers = [];
        this.alliances = [];
        this.tournament = null;
        this.achievements = [];
        this.statistics = {
            totalGames: 0,
            totalTurns: 0,
            totalMoney: 0,
            totalProperties: 0,
            totalAuctions: 0,
            totalTrades: 0
        };
        
        this.initializeGame();
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–≥—Ä—É
     */
    initializeGame() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        this.board = board;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        this.loadSettings();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —á–∞—Ç
        this.initializeChat();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–∫—Ü–∏–æ–Ω—ã
        this.initializeAuctions();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–≥–æ–¥—É
        this.initializeWeather();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è
        this.initializeEvents();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é
        this.initializeTrading();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–ª—å—è–Ω—Å—ã
        this.initializeAlliances();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç—É—Ä–Ω–∏—Ä—ã
        this.initializeTournaments();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        this.initializeAchievements();

        // –í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏–ª–∏ initializeGame)
        if (window.localStorage) {
            const saved = localStorage.getItem('monopoly-autosave');
            if (saved) {
                setTimeout(() => {
                    if (confirm('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∏–≥—Ä–∞. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                        try {
                            this.loadGame(JSON.parse(saved));
                        } catch (e) { alert('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã!'); }
                    } else {
                        localStorage.removeItem('monopoly-autosave');
                    }
                }, 200);
            }
        }
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∏–≥—Ä—É
     * @param {Array} playerData - –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–æ–≤
     */
    startNewGame(playerData) {
        this.players = [];
        this.currentPlayerIndex = 0;
        this.turnNumber = 0;
        this.gameState = 'playing';
        this.gameHistory = [];
        
        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤
        playerData.forEach((data, index) => {
            const player = new Player(data.id, data.name, data.token);
            player.turnOrder = index;
            this.players.push(player);
        });
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∫–∞–∫ —Ç–µ–∫—É—â–µ–≥–æ
        this.setCurrentPlayer(0);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        this.board.initializeBoard();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–≥–æ–¥—É
        this.updateWeather();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è
        this.updateEvents();
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.GAME_START', { 
            player: this.players[0].name 
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        this.updateGameUI();
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        if (this.settings.autoSave) {
            this.saveGame();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        this.startGameLoop();
    }

    /**
     * –ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
     */
    startGameLoop() {
        this.gameLoop = setInterval(() => {
            if (this.gameState === 'playing') {
                this.updateGameLoop();
            }
        }, 1000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
     */
    updateGameLoop() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–≥–æ–¥—É
        this.updateWeather();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è
        this.updateEvents();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞—É–∫—Ü–∏–æ–Ω—ã
        this.updateAuctions();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é
        this.updateTrading();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–ª—å—è–Ω—Å—ã
        this.updateAlliances();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä—ã
        this.updateTournaments();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        this.updateAchievements();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        this.updateStatistics();
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≥–æ–¥–Ω—É—é —Å–∏—Å—Ç–µ–º—É
     */
    initializeWeather() {
        this.weather = {
            type: 'sunny',
            duration: 0,
            effects: {},
            intensity: 1
        };
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–≥–æ–¥—É
     */
    updateWeather() {
        // –ö–∞–∂–¥—ã–µ 5 —Ö–æ–¥–æ–≤ –º–µ–Ω—è–µ–º –ø–æ–≥–æ–¥—É
        if (this.turnNumber % 5 === 0 && this.turnNumber > 0) {
            this.changeWeather();
        }
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø–æ–≥–æ–¥—ã
        this.applyWeatherEffects();
    }

    /**
     * –ú–µ–Ω—è–µ—Ç –ø–æ–≥–æ–¥—É
     */
    changeWeather() {
        const weatherTypes = CONFIG.WEATHER;
        const newWeather = weatherTypes[randomInt(0, weatherTypes.length - 1)];
        
        this.weather = {
            type: newWeather.type,
            duration: newWeather.duration || 3,
            effects: newWeather.effects || {},
            intensity: newWeather.intensity || 1
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.WEATHER_CHANGE', {
            weather: getText(`WEATHER.${newWeather.type.toUpperCase()}`)
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
        this.updateWeatherDisplay();
    }

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã –ø–æ–≥–æ–¥—ã
     */
    applyWeatherEffects() {
        if (!this.weather.effects) return;
        
        this.players.forEach(player => {
            if (player.bankrupt) return;
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –∞—Ä–µ–Ω–¥–Ω—É—é –ø–ª–∞—Ç—É
            if (this.weather.effects.rent) {
                player.properties.forEach(property => {
                    if (property.rent) {
                        property.rent *= this.weather.effects.rent;
                    }
                });
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ
            if (this.weather.effects.movement) {
                player.movementModifier = this.weather.effects.movement;
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
            if (this.weather.effects.building) {
                player.buildingModifier = this.weather.effects.building;
            }
        });
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Å–æ–±—ã—Ç–∏–π
     */
    initializeEvents() {
        this.economicEvent = null;
        this.culturalEvent = null;
        this.eventHistory = [];
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è
     */
    updateEvents() {
        // –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –∫–∞–∂–¥—ã–µ 10 —Ö–æ–¥–æ–≤
        if (this.turnNumber % 10 === 0 && this.turnNumber > 0) {
            this.triggerEconomicEvent();
        }
        
        // –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∫–∞–∂–¥—ã–µ 15 —Ö–æ–¥–æ–≤
        if (this.turnNumber % 15 === 0 && this.turnNumber > 0) {
            this.triggerCulturalEvent();
        }
    }

    /**
     * –ó–∞–ø—É—Å–∫–∞–µ—Ç —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ
     */
    triggerEconomicEvent() {
        const events = CONFIG.ECONOMIC_EVENTS;
        const event = events[randomInt(0, events.length - 1)];
        
        this.economicEvent = {
            ...event,
            active: true,
            duration: event.duration || 5
        };
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã —Å–æ–±—ã—Ç–∏—è
        this.applyEconomicEvent();
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.ECONOMIC_EVENT', {
            event: getText(`ECONOMIC_EVENTS.${event.type.toUpperCase()}`)
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        this.updateEventsDisplay();
    }

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ
     */
    applyEconomicEvent() {
        if (!this.economicEvent || !this.economicEvent.active) return;
        
        this.players.forEach(player => {
            if (player.bankrupt) return;
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
            if (this.economicEvent.propertyValue) {
                player.properties.forEach(property => {
                    property.value *= this.economicEvent.propertyValue;
                });
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –¥–æ—Ö–æ–¥—ã
            if (this.economicEvent.income) {
                player.incomeModifier = this.economicEvent.income;
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –Ω–∞–ª–æ–≥–∏
            if (this.economicEvent.taxes) {
                player.taxModifier = this.economicEvent.taxes;
            }
        });
    }

    /**
     * –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
     */
    triggerCulturalEvent() {
        const events = CONFIG.CULTURAL_EVENTS;
        const event = events[randomInt(0, events.length - 1)];
        
        this.culturalEvent = {
            ...event,
            active: true,
            duration: event.duration || 3
        };
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã —Å–æ–±—ã—Ç–∏—è
        this.applyCulturalEvent();
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.CULTURAL_EVENT', {
            event: getText(`CULTURAL_EVENTS.${event.type.toUpperCase()}`)
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        this.updateEventsDisplay();
    }

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
     */
    applyCulturalEvent() {
        if (!this.culturalEvent || !this.culturalEvent.active) return;
        
        this.players.forEach(player => {
            if (player.bankrupt) return;
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã
            if (this.culturalEvent.tourism) {
                player.properties.forEach(property => {
                    if (property.type === 'tourism') {
                        property.rent *= this.culturalEvent.tourism;
                    }
                });
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
            if (this.culturalEvent.culture) {
                player.properties.forEach(property => {
                    if (property.type === 'culture') {
                        property.rent *= this.culturalEvent.culture;
                    }
                });
            }
        });
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Ç–æ—Ä–≥–æ–≤–ª–∏
     */
    initializeTrading() {
        this.tradeOffers = [];
        this.tradeHistory = [];
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ—Ä–≥–æ–≤–ª—é
     */
    updateTrading() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Ç–æ—Ä–≥–æ–≤–ª–∏
        this.tradeOffers = this.tradeOffers.filter(offer => {
            if (offer.expiresAt && Date.now() > offer.expiresAt) {
                this.addChatMessage('system', getText('MESSAGES.TRADE_EXPIRED', {
                    from: offer.from.name,
                    to: offer.to.name
                }));
                return false;
            }
            return true;
        });
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
     * @param {Player} from - –∏–≥—Ä–æ–∫, –ø—Ä–µ–¥–ª–∞–≥–∞—é—â–∏–π —Ç–æ—Ä–≥–æ–≤–ª—é
     * @param {Player} to - –∏–≥—Ä–æ–∫, –ø–æ–ª—É—á–∞—é—â–∏–π –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
     * @param {Object} offer - —á—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è
     * @param {Object} request - —á—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è
     */
    createTradeOffer(from, to, offer, request) {
        const tradeOffer = {
            id: generateId(),
            from: from,
            to: to,
            offer: offer,
            request: request,
            createdAt: Date.now(),
            expiresAt: Date.now() + (5 * 60 * 1000), // 5 –º–∏–Ω—É—Ç
            status: 'pending'
        };
        
        this.tradeOffers.push(tradeOffer);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.TRADE_OFFER', {
            from: from.name,
            to: to.name
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
        this.updateTradingDisplay();
        
        return tradeOffer;
    }

    /**
     * –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
     * @param {string} tradeId - ID –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
     */
    acceptTradeOffer(tradeId) {
        const offer = this.tradeOffers.find(o => o.id === tradeId);
        if (!offer || offer.status !== 'pending') return false;
        
        // –í—ã–ø–æ–ª–Ω—è–µ–º –æ–±–º–µ–Ω
        this.executeTrade(offer);
        
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
        this.tradeOffers = this.tradeOffers.filter(o => o.id !== tradeId);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        this.tradeHistory.push({
            ...offer,
            status: 'accepted',
            completedAt: Date.now()
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.TRADE_ACCEPTED', {
            from: offer.from.name,
            to: offer.to.name
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
        this.updateTradingDisplay();
        
        return true;
    }

    /**
     * –û—Ç–∫–ª–æ–Ω—è–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
     * @param {string} tradeId - ID –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
     */
    rejectTradeOffer(tradeId) {
        const offer = this.tradeOffers.find(o => o.id === tradeId);
        if (!offer || offer.status !== 'pending') return false;
        
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
        this.tradeOffers = this.tradeOffers.filter(o => o.id !== tradeId);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        this.tradeHistory.push({
            ...offer,
            status: 'rejected',
            completedAt: Date.now()
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.TRADE_REJECTED', {
            from: offer.from.name,
            to: offer.to.name
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
        this.updateTradingDisplay();
        
        return true;
    }

    /**
     * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ—Ä–≥–æ–≤—É—é —Å–¥–µ–ª–∫—É
     * @param {Object} offer - –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
     */
    executeTrade(offer) {
        const { from, to, offer: offerItems, request: requestItems } = offer;
        
        // –û–±–º–µ–Ω–∏–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
        if (offerItems.money) {
            from.payMoney(offerItems.money);
            to.receiveMoney(offerItems.money);
        }
        
        if (requestItems.money) {
            to.payMoney(requestItems.money);
            from.receiveMoney(requestItems.money);
        }
        
        // –û–±–º–µ–Ω–∏–≤–∞–µ–º –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
        if (offerItems.properties) {
            offerItems.properties.forEach(propertyId => {
                const property = from.properties.find(p => p.id === propertyId);
                if (property) {
                    from.sellProperty(property, to);
                }
            });
        }
        
        if (requestItems.properties) {
            requestItems.properties.forEach(propertyId => {
                const property = to.properties.find(p => p.id === propertyId);
                if (property) {
                    to.sellProperty(property, from);
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        this.statistics.totalTrades++;
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –∞–ª—å—è–Ω—Å–æ–≤
     */
    initializeAlliances() {
        this.alliances = [];
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –∞–ª—å—è–Ω—Å—ã
     */
    updateAlliances() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –∞–ª—å—è–Ω—Å–æ–≤
        this.alliances.forEach(alliance => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞—Ä—É—à–µ–Ω—ã –ª–∏ —É—Å–ª–æ–≤–∏—è –∞–ª—å—è–Ω—Å–∞
            if (alliance.conditions && !this.checkAllianceConditions(alliance)) {
                this.breakAlliance(alliance);
            }
        });
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –∞–ª—å—è–Ω—Å
     * @param {Array} players - –∏–≥—Ä–æ–∫–∏ –≤ –∞–ª—å—è–Ω—Å–µ
     * @param {Object} conditions - —É—Å–ª–æ–≤–∏—è –∞–ª—å—è–Ω—Å–∞
     */
    createAlliance(players, conditions = {}) {
        const alliance = {
            id: generateId(),
            players: players,
            conditions: conditions,
            createdAt: Date.now(),
            benefits: {
                rentSharing: 0.1, // 10% –æ—Ç –∞—Ä–µ–Ω–¥—ã –¥–µ–ª–∏—Ç—Å—è –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
                tradeDiscount: 0.05, // 5% —Å–∫–∏–¥–∫–∞ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é
                mutualSupport: true
            }
        };
        
        this.alliances.push(alliance);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.ALLIANCE_FORMED', {
            players: players.map(p => p.name).join(', ')
        }));
        
        return alliance;
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –∞–ª—å—è–Ω—Å–∞
     * @param {Object} alliance - –∞–ª—å—è–Ω—Å
     */
    checkAllianceConditions(alliance) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ –≤—Å–µ –µ—â–µ –≤ –∏–≥—Ä–µ
        return alliance.players.every(player => !player.bankrupt);
    }

    /**
     * –†–∞—Å—Ç–æ—Ä–≥–∞–µ—Ç –∞–ª—å—è–Ω—Å
     * @param {Object} alliance - –∞–ª—å—è–Ω—Å
     */
    breakAlliance(alliance) {
        this.alliances = this.alliances.filter(a => a.id !== alliance.id);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.ALLIANCE_BROKEN', {
            players: alliance.players.map(p => p.name).join(', ')
        }));
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Ç—É—Ä–Ω–∏—Ä–æ–≤
     */
    initializeTournaments() {
        this.tournament = null;
        this.tournamentHistory = [];
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç—É—Ä–Ω–∏—Ä—ã
     */
    updateTournaments() {
        if (this.tournament) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
            if (this.checkTournamentEnd()) {
                this.endTournament();
            }
        }
    }

    /**
     * –ù–∞—á–∏–Ω–∞–µ—Ç —Ç—É—Ä–Ω–∏—Ä
     * @param {Object} config - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
     */
    startTournament(config) {
        this.tournament = {
            id: generateId(),
            type: config.type || 'elimination',
            players: [...this.players],
            rounds: [],
            currentRound: 0,
            startedAt: Date.now(),
            config: config
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.TOURNAMENT_START', {
            type: getText(`TOURNAMENT.${config.type.toUpperCase()}`)
        }));
        
        return this.tournament;
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞
     */
    checkTournamentEnd() {
        if (!this.tournament) return false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
        switch (this.tournament.type) {
            case 'elimination':
                return this.tournament.players.length <= 1;
            case 'points':
                return this.tournament.currentRound >= this.tournament.config.maxRounds;
            default:
                return false;
        }
    }

    /**
     * –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç—É—Ä–Ω–∏—Ä
     */
    endTournament() {
        if (!this.tournament) return;
        
        const winner = this.tournament.players[0];
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        this.tournamentHistory.push({
            ...this.tournament,
            endedAt: Date.now(),
            winner: winner
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.TOURNAMENT_END', {
            winner: winner.name
        }));
        
        this.tournament = null;
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
     */
    initializeAchievements() {
        this.achievements = [];
        this.achievementHistory = [];
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
     */
    updateAchievements() {
        this.players.forEach(player => {
            if (player.bankrupt) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            this.checkAchievements(player);
        });
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
     * @param {Player} player - –∏–≥—Ä–æ–∫
     */
    checkAchievements(player) {
        const achievements = CONFIG.ACHIEVEMENTS;
        
        achievements.forEach(achievement => {
            if (this.hasAchievement(player, achievement.id)) return;
            
            if (this.checkAchievementCondition(player, achievement)) {
                this.unlockAchievement(player, achievement);
            }
        });
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É –∏–≥—Ä–æ–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {string} achievementId - ID –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
     */
    hasAchievement(player, achievementId) {
        return player.achievements.some(a => a.id === achievementId);
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} achievement - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
     */
    checkAchievementCondition(player, achievement) {
        switch (achievement.type) {
            case 'money':
                return player.money >= achievement.condition;
            case 'properties':
                return player.properties.length >= achievement.condition;
            case 'trades':
                return this.tradeHistory.filter(t => 
                    t.from.id === player.id || t.to.id === player.id
                ).length >= achievement.condition;
            case 'wins':
                return player.wins >= achievement.condition;
            default:
                return false;
        }
    }

    /**
     * –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} achievement - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
     */
    unlockAchievement(player, achievement) {
        player.achievements.push({
            ...achievement,
            unlockedAt: Date.now()
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        this.achievementHistory.push({
            player: player,
            achievement: achievement,
            unlockedAt: Date.now()
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.ACHIEVEMENT_UNLOCKED', {
            player: player.name,
            achievement: getText(`ACHIEVEMENTS.${achievement.id.toUpperCase()}`)
        }));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        this.updateAchievementsDisplay();
        // –ê–Ω–∏–º–∞—Ü–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const panel = document.getElementById('achievements-panel');
        if (panel) {
            const els = panel.querySelectorAll('.achievement');
            if (els.length) {
                const el = els[els.length - 1];
                el.classList.add('unlocked');
                setTimeout(() => el.classList.remove('unlocked'), 1000);
            }
        }
        if (typeof showToast === 'function') {
            showToast(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.name}`);
        } else if (typeof utils.showToast === 'function') {
            utils.showToast(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.name}`);
        }
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
     */
    updateStatistics() {
        this.statistics.totalTurns = this.turnNumber;
        this.statistics.totalMoney = this.players.reduce((sum, p) => sum + p.money, 0);
        this.statistics.totalProperties = this.players.reduce((sum, p) => sum + p.properties.length, 0);
    }

    /**
     * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
     * @param {number} index - –∏–Ω–¥–µ–∫—Å –∏–≥—Ä–æ–∫–∞
     */
    setCurrentPlayer(index) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        if (this.players[this.currentPlayerIndex]) {
            this.players[this.currentPlayerIndex].setCurrentPlayer(false);
        }
        
        this.currentPlayerIndex = index;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–º—É –∏–≥—Ä–æ–∫—É
        if (this.players[this.currentPlayerIndex]) {
            this.players[this.currentPlayerIndex].setCurrentPlayer(true);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        this.updateCurrentPlayerDisplay();
    }

    /**
     * –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É
     */
    nextPlayer() {
        let nextIndex = (this.currentPlayerIndex + 1) % this.players.length;
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–∞–Ω–∫—Ä–æ—Ç–æ–≤
        while (this.players[nextIndex] && this.players[nextIndex].bankrupt) {
            nextIndex = (nextIndex + 1) % this.players.length;
            
            // –ï—Å–ª–∏ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ –±–∞–Ω–∫—Ä–æ—Ç—ã, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ
            if (nextIndex === this.currentPlayerIndex) {
                this.endGame();
                return;
            }
        }
        
        this.setCurrentPlayer(nextIndex);
        this.turnNumber++;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        this.board.update();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        this.checkGameEndConditions();
        
        // --- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ---
        if (window.localStorage) {
            try {
                const saveData = this.saveGame();
                localStorage.setItem('monopoly-autosave', JSON.stringify(saveData));
            } catch (e) { console.warn('Auto-save failed:', e); }
        }
    }

    /**
     * –ë—Ä–æ—Å–∞–µ—Ç –∫–æ—Å—Ç–∏
     * @returns {Object} —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—Ä–æ—Å–∫–∞
     */
    async rollDice() {
        const currentPlayer = this.players[this.currentPlayerIndex];
        if (!currentPlayer || currentPlayer.bankrupt) {
            return null;
        }
        // –ë—Ä–æ—Å–∞–µ–º –∫–æ—Å—Ç–∏
        this.dice = rollDice();
        currentPlayer.lastRoll = this.dice;
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª—å
        if (this.dice.isDouble) {
            currentPlayer.doublesCount++;
        } else {
            currentPlayer.doublesCount = 0;
        }
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Ç—é—Ä—å–º—É (3 –¥—É–±–ª—è –ø–æ–¥—Ä—è–¥)
        if (currentPlayer.doublesCount >= 3) {
            currentPlayer.goToJail();
            currentPlayer.doublesCount = 0;
            this.addChatMessage('system', getText('MESSAGES.JAIL_VISIT', { 
                player: currentPlayer.name 
            }));
            this.nextPlayer();
            return this.dice;
        }
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        this.addChatMessage('system', getText('MESSAGES.DICE_ROLL', {
            player: currentPlayer.name,
            dice1: this.dice.dice1,
            dice2: this.dice.dice2
        }));
        // –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–û–ï –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        const oldPos = currentPlayer.position;
        const steps = this.dice.total;
        const newPos = (oldPos + steps) % 40;
        await currentPlayer.animateTokenMove(oldPos, newPos);
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞
        currentPlayer.position = newPos;
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–µ—Ç–∫—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –ø–æ–ø–∞–ª –∏–≥—Ä–æ–∫
        this.handleCellLanding(currentPlayer, currentPlayer.position);
        // –ï—Å–ª–∏ –Ω–µ –¥—É–±–ª—å, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É
        if (!this.dice.isDouble) {
            this.nextPlayer();
        }
        return this.dice;
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–µ –Ω–∞ –∫–ª–µ—Ç–∫—É
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {number} position - –ø–æ–∑–∏—Ü–∏—è
     */
    handleCellLanding(player, position) {
        const cell = this.board.getCell(position);
        if (!cell) return;
        
        switch (cell.type) {
            case 'property':
                this.handlePropertyLanding(player, cell);
                break;
            case 'chance':
                this.handleChanceCard(player);
                break;
            case 'treasure':
                this.handleTreasureCard(player);
                break;
            case 'tax':
                this.handleTaxLanding(player, cell);
                break;
            case 'go_to_jail':
                player.goToJail();
                this.addChatMessage('system', getText('MESSAGES.JAIL_VISIT', { 
                    player: player.name 
                }));
                break;
            case 'free_parking':
                // –ù–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
                break;
        }
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} cell - –∫–ª–µ—Ç–∫–∞
     */
    handlePropertyLanding(player, cell) {
        if (!cell.owner) {
            // –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–∞ - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∫—É–ø–∏—Ç—å
            this.offerPropertyPurchase(player, cell);
        } else if (cell.owner !== player.id) {
            // –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –∏–≥—Ä–æ–∫—É - –ø–ª–∞—Ç–∏–º –∞—Ä–µ–Ω–¥—É
            this.handleRentPayment(player, cell);
        }
    }

    /**
     * –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫—É–ø–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} cell - –∫–ª–µ—Ç–∫–∞
     */
    offerPropertyPurchase(player, cell) {
        if (player.hasMoney(cell.price)) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –ø–æ–∫—É–ø–∫–∏
            this.showPurchaseDialog(player, cell);
        } else {
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞—É–∫—Ü–∏–æ–Ω
            this.startAuction(cell);
        }
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–ø–ª–∞—Ç—É –∞—Ä–µ–Ω–¥—ã
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} cell - –∫–ª–µ—Ç–∫–∞
     */
    handleRentPayment(player, cell) {
        const owner = this.players.find(p => p.id === cell.owner);
        if (!owner) return;
        
        const rentAmount = this.board.calculateRent(cell.position, owner.id);
        
        if (player.canPayRent(rentAmount)) {
            if (player.payRent(rentAmount, owner)) {
                this.addChatMessage('system', getText('MESSAGES.RENT_PAID', {
                    player: player.name,
                    amount: rentAmount,
                    owner: owner.name
                }));
            }
        } else {
            // –ò–≥—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø–ª–∞—Ç–∏—Ç—å - –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ
            this.handleBankruptcy(player, owner, rentAmount);
        }
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–∞
     * @param {Player} player - –±–∞–Ω–∫—Ä–æ—Ç
     * @param {Player} creditor - –∫—Ä–µ–¥–∏—Ç–æ—Ä
     * @param {number} debt - –¥–æ–ª–≥
     */
    handleBankruptcy(player, creditor, debt) {
        // –ü–µ—Ä–µ–¥–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤—ã –∫—Ä–µ–¥–∏—Ç–æ—Ä—É
        player.properties.forEach(position => {
            const cell = this.board.getCell(position);
            if (cell) {
                cell.owner = creditor.id;
                creditor.properties.push(position);
            }
        });
        
        // –ü–µ—Ä–µ–¥–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–µ–Ω—å–≥–∏
        if (player.money > 0) {
            creditor.addMoney(player.money);
            player.removeMoney(player.money);
        }
        
        player.declareBankruptcy();
        
        this.addChatMessage('system', getText('MESSAGES.BANKRUPTCY', { 
            player: player.name 
        }));
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        this.checkGameEndConditions();
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –®–∞–Ω—Å
     * @param {Player} player - –∏–≥—Ä–æ–∫
     */
    handleChanceCard(player) {
        const card = randomChoice(CONFIG.CHANCE_CARDS);
        this.showChanceCard(card);
        
        this.applyChanceCard(player, card);
        this.stats.chanceCardsDrawn++;
    }

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –®–∞–Ω—Å
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} card - –∫–∞—Ä—Ç–æ—á–∫–∞
     */
    applyChanceCard(player, card) {
        switch (card.type) {
            case 'money':
                if (card.amount > 0) {
                    player.addMoney(card.amount);
                } else {
                    player.removeMoney(Math.abs(card.amount));
                }
                break;
            case 'move':
                player.moveToPosition(card.target, true);
                this.handleCellLanding(player, player.position);
                break;
        }
        
        this.addChatMessage('system', getText('MESSAGES.CHANCE_CARD', { 
            text: card.text 
        }));
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –ö–∞–∑–Ω–∞
     * @param {Player} player - –∏–≥—Ä–æ–∫
     */
    handleTreasureCard(player) {
        const card = randomChoice(CONFIG.TREASURE_CARDS);
        this.showTreasureCard(card);
        
        this.applyTreasureCard(player, card);
        this.stats.treasureCardsDrawn++;
    }

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –ö–∞–∑–Ω–∞
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} card - –∫–∞—Ä—Ç–æ—á–∫–∞
     */
    applyTreasureCard(player, card) {
        switch (card.type) {
            case 'money':
                if (card.amount > 0) {
                    player.addMoney(card.amount);
                } else {
                    player.removeMoney(Math.abs(card.amount));
                }
                break;
        }
        
        this.addChatMessage('system', getText('MESSAGES.TREASURE_CARD', { 
            text: card.text 
        }));
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–µ –Ω–∞ –Ω–∞–ª–æ–≥–æ–≤—É—é –∫–ª–µ—Ç–∫—É
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} cell - –∫–ª–µ—Ç–∫–∞
     */
    handleTaxLanding(player, cell) {
        const taxAmount = cell.price;
        
        if (player.hasMoney(taxAmount)) {
            player.removeMoney(taxAmount, 'tax');
            this.addChatMessage('system', `${player.name} –∑–∞–ø–ª–∞—Ç–∏–ª –Ω–∞–ª–æ–≥ ${taxAmount}‚ÇΩ`);
        } else {
            this.handleBankruptcy(player, null, taxAmount);
        }
    }

    /**
     * –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞—É–∫—Ü–∏–æ–Ω
     * @param {Object} cell - –∫–ª–µ—Ç–∫–∞ –¥–ª—è –∞—É–∫—Ü–∏–æ–Ω–∞
     */
    startAuction(cell) {
        this.auction = {
            cell: cell,
            currentBid: 0,
            currentBidder: null,
            participants: this.players.filter(p => !p.bankrupt),
            timeLeft: CONFIG.AUCTION.TIME_LIMIT,
            active: true
        };
        
        this.addChatMessage('system', getText('MESSAGES.AUCTION_START', { 
            property: cell.name 
        }));
        
        this.showAuctionDialog();
    }

    /**
     * –î–µ–ª–∞–µ—Ç —Å—Ç–∞–≤–∫—É –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ
     * @param {number} playerId - ID –∏–≥—Ä–æ–∫–∞
     * @param {number} amount - —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏
     * @returns {boolean} true –µ—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞
     */
    makeBid(playerId, amount) {
        if (!this.auction || !this.auction.active) {
            return false;
        }
        
        const player = this.players.find(p => p.id === playerId);
        if (!player || player.bankrupt || !player.hasMoney(amount)) {
            return false;
        }
        
        if (amount <= this.auction.currentBid) {
            return false;
        }
        
        this.auction.currentBid = amount;
        this.auction.currentBidder = playerId;
        this.auction.timeLeft = CONFIG.AUCTION.TIME_LIMIT;
        
        this.updateAuctionDisplay();
        return true;
    }

    /**
     * –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∞—É–∫—Ü–∏–æ–Ω
     */
    endAuction() {
        if (!this.auction || !this.auction.active) {
            return;
        }
        
        if (this.auction.currentBidder) {
            const winner = this.players.find(p => p.id === this.auction.currentBidder);
            if (winner && winner.hasMoney(this.auction.currentBid)) {
                winner.removeMoney(this.auction.currentBid, 'auction');
                this.board.buyCell(this.auction.cell.position, winner.id, this.auction.currentBid);
                winner.properties.push(this.auction.cell.position);
                winner.stats.auctionsWon++;
                
                this.addChatMessage('system', getText('MESSAGES.AUCTION_WIN', {
                    player: winner.name,
                    amount: this.auction.currentBid
                }));
            }
        }
        
        this.auction = null;
        this.hideAuctionDialog();
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
     */
    checkGameEndConditions() {
        const activePlayers = this.players.filter(p => !p.bankrupt);
        
        if (activePlayers.length <= 1) {
            this.endGame();
        }
    }

    /**
     * –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏–≥—Ä—É
     */
    endGame() {
        this.gameState = 'finished';
        
        const winner = this.players.find(p => !p.bankrupt);
        if (winner) {
            this.addChatMessage('system', getText('MESSAGES.GAME_OVER', { 
                winner: winner.name 
            }));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            this.showVictoryScreen(winner);
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        this.saveGameStats();
    }

    /**
     * –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
     * @param {string} sender - –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
     * @param {string} message - —Å–æ–æ–±—â–µ–Ω–∏–µ
     */
    addChatMessage(sender, message) {
        const chatMessage = {
            id: generateId(),
            sender: sender,
            message: message,
            timestamp: new Date().toISOString()
        };
        
        this.chat.push(chatMessage);
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
        if (this.chat.length > 100) {
            this.chat.shift();
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º UI —á–∞—Ç–∞
        this.updateChatDisplay();
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä—ã
     */
    updateGameUI() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
        this.players.forEach(player => {
            player.updateMoneyDisplay();
            player.updateTokenPosition();
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        this.updateCurrentPlayerDisplay();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
        this.updateWeatherDisplay();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        this.updateEventsDisplay();
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
     */
    updateCurrentPlayerDisplay() {
        const currentPlayer = this.players[this.currentPlayerIndex];
        if (!currentPlayer) return;
        
        const playerInfo = document.querySelector('.current-player .player-info');
        if (playerInfo) {
            const tokenImg = playerInfo.querySelector('.player-token');
            const playerName = playerInfo.querySelector('.player-name');
            
            if (tokenImg) tokenImg.src = currentPlayer.token;
            if (playerName) playerName.textContent = currentPlayer.name;
        }
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
     */
    updateWeatherDisplay() {
        const weatherElement = document.getElementById('current-weather');
        if (weatherElement) {
            const weatherType = CONFIG.WEATHER_TYPES.find(w => w.id === this.board.weather);
            weatherElement.textContent = weatherType ? weatherType.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
     */
    updateEventsDisplay() {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∞—Ç–∞
     */
    updateChatDisplay() {
        const chatMessages = document.getElementById('chat-messages');
        if (!chatMessages) return;
        
        chatMessages.innerHTML = '';
        
        this.chat.forEach(msg => {
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.innerHTML = `
                <span class="message-sender">${escapeHTML(msg.sender)}:</span>
                <span class="message-text">${escapeHTML(msg.message)}</span>
            `;
            chatMessages.appendChild(messageElement);
        });
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞
     */
    updateAuctionDisplay() {
        if (!this.auction) return;
        
        const bidAmount = document.getElementById('current-bid-amount');
        const bidder = document.getElementById('current-bidder');
        const timer = document.getElementById('auction-time');
        
        if (bidAmount) bidAmount.textContent = formatMoney(this.auction.currentBid);
        if (bidder) {
            const currentBidderPlayer = this.players.find(p => p.id === this.auction.currentBidder);
            bidder.textContent = currentBidderPlayer ? currentBidderPlayer.name : '–ù–µ—Ç';
        }
        if (timer) timer.textContent = this.auction.timeLeft;
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –ø–æ–∫—É–ø–∫–∏
     * @param {Player} player - –∏–≥—Ä–æ–∫
     * @param {Object} cell - –∫–ª–µ—Ç–∫–∞
     */
    showPurchaseDialog(player, cell) {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–∞ –ø–æ–∫—É–ø–∫–∏
        const modal = document.getElementById('modal-overlay');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        
        modalTitle.textContent = '–ü–æ–∫—É–ø–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏';
        modalContent.innerHTML = `
            <p>–í—ã —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å ${cell.name} –∑–∞ ${formatMoney(cell.price)}?</p>
            <div class="property-info">
                <p><strong>–ê—Ä–µ–Ω–¥–Ω–∞—è –ø–ª–∞—Ç–∞:</strong></p>
                <ul>
                    ${cell.rent.map((rent, index) => 
                        `<li>${index === 0 ? '–ë–µ–∑ —É–ª—É—á—à–µ–Ω–∏–π' : `${index} —É–ª—É—á—à–µ–Ω–∏–π`}: ${formatMoney(rent)}</li>`
                    ).join('')}
                </ul>
            </div>
        `;
        
        modal.classList.remove('hidden');
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('modal-confirm').onclick = () => {
            if (player.buyProperty(cell.position, cell.price)) {
                this.addChatMessage('system', getText('MESSAGES.PROPERTY_PURCHASED', {
                    player: player.name,
                    property: cell.name,
                    price: cell.price
                }));
            }
            modal.classList.add('hidden');
        };
        
        document.getElementById('modal-cancel').onclick = () => {
            this.startAuction(cell);
            modal.classList.add('hidden');
        };
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –®–∞–Ω—Å
     * @param {Object} card - –∫–∞—Ä—Ç–æ—á–∫–∞
     */
    showChanceCard(card) {
        const cardModal = document.getElementById('card-modal');
        const cardTitle = document.getElementById('card-title');
        const cardText = document.getElementById('card-text');
        
        cardTitle.textContent = '–®–ê–ù–°';
        cardText.textContent = card.text;
        
        cardModal.classList.remove('hidden');
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –ö–∞–∑–Ω–∞
     * @param {Object} card - –∫–∞—Ä—Ç–æ—á–∫–∞
     */
    showTreasureCard(card) {
        const cardModal = document.getElementById('card-modal');
        const cardTitle = document.getElementById('card-title');
        const cardText = document.getElementById('card-text');
        
        cardTitle.textContent = '–ö–ê–ó–ù–ê';
        cardText.textContent = card.text;
        
        cardModal.classList.remove('hidden');
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∞—É–∫—Ü–∏–æ–Ω–∞
     */
    showAuctionDialog() {
        const auctionModal = document.getElementById('auction-modal');
        const propertyName = document.getElementById('auction-property');
        
        if (propertyName) {
            propertyName.textContent = this.auction.cell.name;
        }
        
        auctionModal.classList.remove('hidden');
        this.updateAuctionDisplay();
    }

    /**
     * –°–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∞—É–∫—Ü–∏–æ–Ω–∞
     */
    hideAuctionDialog() {
        const auctionModal = document.getElementById('auction-modal');
        auctionModal.classList.add('hidden');
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
     * @param {Player} winner - –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
     */
    showVictoryScreen(winner) {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        console.log(`–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${winner.name}`);
        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∞–ª—é—Ç–∞
        for (let i = 0; i < 3; i++) {
            setTimeout(() => {
                const firework = document.createElement('div');
                firework.className = 'firework';
                for (let j = 0; j < 18; j++) {
                    const particle = document.createElement('div');
                    particle.className = 'firework__particle';
                    const angle = (j / 18) * 2 * Math.PI;
                    const radius = 120 + Math.random() * 40;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    particle.style.setProperty('--x', `${x}px`);
                    particle.style.setProperty('--y', `${y}px`);
                    particle.style.background = `hsl(${Math.floor(Math.random()*360)},90%,60%)`;
                    firework.appendChild(particle);
                }
                document.body.appendChild(firework);
                setTimeout(() => firework.remove(), 1500);
            }, i * 400);
        }
        const victoryModal = document.getElementById('victory-modal');
        if (victoryModal) {
          victoryModal.classList.add('fadeInDown');
          setTimeout(() => victoryModal.classList.remove('fadeInDown'), 1000);
        }
    }

    /**
     * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–≥—Ä—É
     */
    saveGame() {
        const gameData = {
            players: this.players.map(p => p.saveState()),
            board: this.board.getState(),
            currentPlayerIndex: this.currentPlayerIndex,
            turnNumber: this.turnNumber,
            gameState: this.gameState,
            settings: this.settings,
            timestamp: new Date().toISOString()
        };
        
        saveToStorage('russian_monopoly_save', gameData);
    }

    /**
     * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–≥—Ä—É
     * @returns {boolean} true –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ø–µ—à–Ω–∞
     */
    loadGame() {
        const gameData = loadFromStorage('russian_monopoly_save');
        if (!gameData) return false;
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤
        this.players = gameData.players.map(playerState => {
            const player = new Player();
            player.loadState(playerState);
            return player;
        });
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        this.board.setState(gameData.board);
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        this.currentPlayerIndex = gameData.currentPlayerIndex;
        this.turnNumber = gameData.turnNumber;
        this.gameState = gameData.gameState;
        this.settings = { ...CONFIG.DEFAULT_SETTINGS, ...gameData.settings };
        
        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        this.updateGameUI();
        
        return true;
    }

    /**
     * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä—ã
     */
    saveGameStats() {
        const stats = {
            players: this.players.map(p => p.getStats()),
            board: this.board.getStats(),
            gameDuration: this.turnNumber,
            winner: this.players.find(p => !p.bankrupt)?.name,
            timestamp: new Date().toISOString()
        };
        
        saveToStorage('russian_monopoly_stats', stats);
    }

    /**
     * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
     */
    loadSettings() {
        const savedSettings = loadFromStorage('russian_monopoly_settings');
        if (savedSettings) {
            this.settings = { ...CONFIG.DEFAULT_SETTINGS, ...savedSettings };
        }
    }

    /**
     * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
     */
    saveSettings() {
        saveToStorage('russian_monopoly_settings', this.settings);
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —á–∞—Ç
     */
    initializeChat() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        const sendButton = document.getElementById('send-message-btn');
        const chatInput = document.getElementById('chat-input');
        
        if (sendButton && chatInput) {
            sendButton.onclick = () => {
                const message = chatInput.value.trim();
                if (message) {
                    this.addChatMessage('–í—ã', message);
                    chatInput.value = '';
                }
            };
            
            chatInput.onkeypress = (e) => {
                if (e.key === 'Enter') {
                    sendButton.click();
                }
            };
        }
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞—É–∫—Ü–∏–æ–Ω—ã
     */
    initializeAuctions() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞—É–∫—Ü–∏–æ–Ω–∞
        const placeBidBtn = document.getElementById('place-bid-btn');
        const passBidBtn = document.getElementById('pass-bid-btn');
        const bidAmount = document.getElementById('bid-amount');
        
        if (placeBidBtn && bidAmount) {
            placeBidBtn.onclick = () => {
                const amount = parseInt(bidAmount.value);
                if (amount > 0) {
                    const currentPlayer = this.players[this.currentPlayerIndex];
                    if (this.makeBid(currentPlayer.id, amount)) {
                        bidAmount.value = '';
                    }
                }
            };
        }
        
        if (passBidBtn) {
            passBidBtn.onclick = () => {
                this.endAuction();
            };
        }
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
     */
    updateAchievementsDisplay() {
        const panel = document.getElementById('achievements-panel');
        if (!panel) return;
        panel.innerHTML = '';
        this.players.forEach(player => {
            player.achievements.forEach(a => {
                const el = document.createElement('div');
                el.className = 'achievement';
                el.textContent = a.name;
                panel.appendChild(el);
            });
        });
    }
}

// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∏–≥—Ä—ã
const game = new Game();

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
if (typeof module !== 'undefined' && module.exports) {
    module.exports = Game;
} 
```

## c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\sw.js
```
/**
 * Service Worker –¥–ª—è –ú–æ–Ω–æ–ø–æ–ª–∏–∏ –†–æ—Å—Å–∏–∏
 * –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç—É
 */

const CACHE_NAME = 'monopoly-russia-v1.0.0';
const STATIC_CACHE = 'monopoly-russia-static-v1.0.0';
const DYNAMIC_CACHE = 'monopoly-russia-dynamic-v1.0.0';

// –§–∞–π–ª—ã –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
const STATIC_FILES = [
    '/',
    '/src/index.html',
    '/src/style.css',
    '/src/game.js',
    '/dist/index.html',
    '/dist/style.min.css',
    '/dist/game.min.js'
];

// –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
const CACHE_STRATEGIES = {
    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
    STATIC: 'static',
    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
    STALE_WHILE_REVALIDATE: 'stale-while-revalidate',
    // –°–µ—Ç—å —Å fallback –Ω–∞ –∫—ç—à
    NETWORK_FIRST: 'network-first',
    // –ö—ç—à —Å fallback –Ω–∞ —Å–µ—Ç—å
    CACHE_FIRST: 'cache-first'
};

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Service Worker
self.addEventListener('install', event => {
    console.log('üîÑ Service Worker: –£—Å—Ç–∞–Ω–æ–≤–∫–∞...');
    
    event.waitUntil(
        caches.open(STATIC_CACHE)
            .then(cache => {
                console.log('üì¶ Service Worker: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤');
                return cache.addAll(STATIC_FILES);
            })
            .then(() => {
                console.log('‚úÖ Service Worker: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                return self.skipWaiting();
            })
            .catch(error => {
                console.error('‚ùå Service Worker: –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏', error);
            })
    );
});

// –ê–∫—Ç–∏–≤–∞—Ü–∏—è Service Worker
self.addEventListener('activate', event => {
    console.log('üöÄ Service Worker: –ê–∫—Ç–∏–≤–∞—Ü–∏—è...');
    
    event.waitUntil(
        caches.keys()
            .then(cacheNames => {
                return Promise.all(
                    cacheNames.map(cacheName => {
                        if (cacheName !== STATIC_CACHE && cacheName !== DYNAMIC_CACHE) {
                            console.log('üóëÔ∏è Service Worker: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞', cacheName);
                            return caches.delete(cacheName);
                        }
                    })
                );
            })
            .then(() => {
                console.log('‚úÖ Service Worker: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                return self.clients.claim();
            })
    );
});

// –ü–µ—Ä–µ—Ö–≤–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
self.addEventListener('fetch', event => {
    const { request } = event;
    const url = new URL(request.url);
    
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
    if (request.method !== 'GET' || url.protocol === 'chrome-extension:') {
        return;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    const strategy = getCacheStrategy(request);
    
    event.respondWith(
        handleRequest(request, strategy)
            .catch(error => {
                console.error('‚ùå Service Worker: –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞', error);
                return handleOfflineFallback(request);
            })
    );
});

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
function getCacheStrategy(request) {
    const url = new URL(request.url);
    
    // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã
    if (url.pathname.match(/\.(css|js|html|woff2|woff|ttf|eot)$/)) {
        return CACHE_STRATEGIES.STATIC;
    }
    
    // API –∑–∞–ø—Ä–æ—Å—ã
    if (url.pathname.startsWith('/api/')) {
        return CACHE_STRATEGIES.NETWORK_FIRST;
    }
    
    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    if (url.pathname.match(/\.(png|jpg|jpeg|gif|svg|webp)$/)) {
        return CACHE_STRATEGIES.CACHE_FIRST;
    }
    
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    return CACHE_STRATEGIES.STALE_WHILE_REVALIDATE;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
async function handleRequest(request, strategy) {
    switch (strategy) {
        case CACHE_STRATEGIES.STATIC:
            return handleStaticCache(request);
        case CACHE_STRATEGIES.CACHE_FIRST:
            return handleCacheFirst(request);
        case CACHE_STRATEGIES.NETWORK_FIRST:
            return handleNetworkFirst(request);
        case CACHE_STRATEGIES.STALE_WHILE_REVALIDATE:
            return handleStaleWhileRevalidate(request);
        default:
            return fetch(request);
    }
}

// –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
async function handleStaticCache(request) {
    const cache = await caches.open(STATIC_CACHE);
    const cachedResponse = await cache.match(request);
    
    if (cachedResponse) {
        return cachedResponse;
    }
    
    try {
        const networkResponse = await fetch(request);
        if (networkResponse.ok) {
            cache.put(request, networkResponse.clone());
        }
        return networkResponse;
    } catch (error) {
        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—É—Ä—Å');
    }
}

// –ö—ç—à –ø–µ—Ä–≤—ã–º
async function handleCacheFirst(request) {
    const cache = await caches.open(DYNAMIC_CACHE);
    const cachedResponse = await cache.match(request);
    
    if (cachedResponse) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –≤ —Ñ–æ–Ω–µ
        fetch(request)
            .then(response => {
                if (response.ok) {
                    cache.put(request, response);
                }
            })
            .catch(() => {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞
            });
        
        return cachedResponse;
    }
    
    try {
        const networkResponse = await fetch(request);
        if (networkResponse.ok) {
            cache.put(request, networkResponse.clone());
        }
        return networkResponse;
    } catch (error) {
        throw new Error('–†–µ—Å—É—Ä—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
    }
}

// –°–µ—Ç—å –ø–µ—Ä–≤—ã–º
async function handleNetworkFirst(request) {
    try {
        const networkResponse = await fetch(request);
        if (networkResponse.ok) {
            const cache = await caches.open(DYNAMIC_CACHE);
            cache.put(request, networkResponse.clone());
        }
        return networkResponse;
    } catch (error) {
        const cache = await caches.open(DYNAMIC_CACHE);
        const cachedResponse = await cache.match(request);
        
        if (cachedResponse) {
            return cachedResponse;
        }
        
        throw new Error('–†–µ—Å—É—Ä—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫—ç—à–µ');
    }
}

// –£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
async function handleStaleWhileRevalidate(request) {
    const cache = await caches.open(DYNAMIC_CACHE);
    const cachedResponse = await cache.match(request);
    
    const fetchPromise = fetch(request)
        .then(networkResponse => {
            if (networkResponse.ok) {
                cache.put(request, networkResponse.clone());
            }
            return networkResponse;
        })
        .catch(() => {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏
        });
    
    if (cachedResponse) {
        return cachedResponse;
    }
    
    try {
        return await fetchPromise;
    } catch (error) {
        throw new Error('–†–µ—Å—É—Ä—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
    }
}

// –û—Ñ–ª–∞–π–Ω fallback
async function handleOfflineFallback(request) {
    const url = new URL(request.url);
    
    // –î–ª—è HTML –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ñ–ª–∞–π–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—É
    if (request.headers.get('accept').includes('text/html')) {
        const cache = await caches.open(STATIC_CACHE);
        const offlinePage = await cache.match('/src/index.html');
        
        if (offlinePage) {
            return new Response(offlinePage.body, {
                status: 200,
                statusText: 'OK',
                headers: {
                    'Content-Type': 'text/html',
                    'X-Offline': 'true'
                }
            });
        }
    }
    
    // –î–ª—è –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
    return new Response('–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º', {
        status: 503,
        statusText: 'Service Unavailable',
        headers: {
            'Content-Type': 'text/plain'
        }
    });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
self.addEventListener('message', event => {
    const { type, data } = event.data;
    
    switch (type) {
        case 'SKIP_WAITING':
            self.skipWaiting();
            break;
        case 'GET_CACHE_INFO':
            getCacheInfo().then(info => {
                event.ports[0].postMessage(info);
            });
            break;
        case 'CLEAR_CACHE':
            clearCache().then(() => {
                event.ports[0].postMessage({ success: true });
            });
            break;
        default:
            console.log('Service Worker: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è', type);
    }
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫—ç—à–µ
async function getCacheInfo() {
    const cacheNames = await caches.keys();
    const cacheInfo = {};
    
    for (const cacheName of cacheNames) {
        const cache = await caches.open(cacheName);
        const requests = await cache.keys();
        cacheInfo[cacheName] = {
            size: requests.length,
            urls: requests.map(req => req.url)
        };
    }
    
    return cacheInfo;
}

// –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
async function clearCache() {
    const cacheNames = await caches.keys();
    await Promise.all(
        cacheNames.map(cacheName => caches.delete(cacheName))
    );
}

// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π
self.addEventListener('periodicsync', event => {
    if (event.tag === 'cleanup-cache') {
        event.waitUntil(cleanupOldCache());
    }
});

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞
async function cleanupOldCache() {
    const cache = await caches.open(DYNAMIC_CACHE);
    const requests = await cache.keys();
    const now = Date.now();
    const maxAge = 7 * 24 * 60 * 60 * 1000; // 7 –¥–Ω–µ–π
    
    for (const request of requests) {
        const response = await cache.match(request);
        const dateHeader = response.headers.get('date');
        
        if (dateHeader) {
            const responseDate = new Date(dateHeader).getTime();
            if (now - responseDate > maxAge) {
                await cache.delete(request);
            }
        }
    }
}

self.addEventListener('push', function(event) {
  let data = {};
  if (event.data) {
    data = event.data.json();
  }
  const title = data.title || 'Monopoly Russia';
  const options = {
    body: data.body || '–£ –≤–∞—Å –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!',
    icon: 'icons/icon-192x192.png',
    badge: 'icons/icon-72x72.png',
    data: data.url || '/' // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –∫–ª–∏–∫—É
  };
  event.waitUntil(
    self.registration.showNotification(title, options)
  );
});

self.addEventListener('notificationclick', function(event) {
  event.notification.close();
  const url = event.notification.data || '/';
  event.waitUntil(
    clients.matchAll({ type: 'window' }).then(windowClients => {
      for (let client of windowClients) {
        if (client.url === url && 'focus' in client) {
          return client.focus();
        }
      }
      if (clients.openWindow) {
        return clients.openWindow(url);
      }
    })
  );
});

console.log('üé≤ Service Worker: –ú–æ–Ω–æ–ø–æ–ª–∏—è –†–æ—Å—Å–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω'); 
```

## c:\Users\joker\OneDrive\Dokumenti\GitHub\Jokersochi\js\ui.js
```
/**
 * –ú–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 * –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —ç–∫—Ä–∞–Ω–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–±—ã—Ç–∏–π –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
 */

import { getText } from './localization.js';
import { formatMoney, generateId } from './utils.js';
import { saveToStorage, loadFromStorage } from './storage.js';
import { randomChoice, rollDice } from './random.js';
// –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
const escapeHTML = (str) => String(str).replace(/[&<>"]'/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
const showToast = (msg) => alert(msg);
const passedStart = (oldPos, newPos) => newPos < oldPos;

class UI {
    constructor() {
        this.currentScreen = 'main-menu';
        this.screens = {};
        this.eventListeners = [];
        
        this.initializeUI();
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
     */
    initializeUI() {
        this.initializeScreens();
        this.initializeEventListeners();
        this.initializeModals();
        this.initializeAnimations();
        this.addDebugTestButtons();
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫—Ä–∞–Ω—ã
     */
    initializeScreens() {
        this.screens = {
            'main-menu': document.getElementById('main-menu'),
            'settings-screen': document.getElementById('settings-screen'),
            'game-screen': document.getElementById('game-screen')
        };
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
     */
    initializeEventListeners() {
        // –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        this.addEventListener('#new-game-btn', 'click', () => {
            this.showScreen('settings-screen');
        });

        this.addEventListener('#join-game-btn', 'click', () => {
            this.showJoinGameDialog();
        });

        this.addEventListener('#settings-btn', 'click', () => {
            this.showScreen('settings-screen');
        });

        this.addEventListener('#rules-btn', 'click', () => {
            this.showRulesDialog();
        });

        // –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
        this.addEventListener('#achievements-btn', 'click', () => {
            this.showAchievementsModal();
        });
        this.addEventListener('#statistics-btn', 'click', () => {
            this.showStatisticsModal();
        });
        this.addEventListener('#tournaments-btn', 'click', () => {
            this.showTournamentsModal();
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        this.addEventListener('#back-to-menu', 'click', () => {
            this.showScreen('main-menu');
        });

        this.addEventListener('#start-game', 'click', () => {
            this.startGame();
        });

        // –ò–≥—Ä–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
        this.addEventListener('#dice-btn', 'click', () => {
            this.rollDice();
        });

        this.addEventListener('#end-turn-btn', 'click', () => {
            this.endTurn();
        });

        // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
        this.addEventListener('#trade-btn', 'click', () => {
            this.showTradeDialog();
        });

        this.addEventListener('#mortgage-btn', 'click', () => {
            this.showMortgageDialog();
        });

        this.addEventListener('#build-btn', 'click', () => {
            this.showBuildDialog();
        });

        this.addEventListener('#auction-btn', 'click', () => {
            this.showAuctionDialog();
        });

        // –í—ã–±–æ—Ä —Ç–æ–∫–µ–Ω–æ–≤
        this.initializeTokenSelection();

        // –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
        this.initializePlayerCountSelection();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª
        this.initializeRuleSettings();

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        this.initializeModalHandlers();

        // –ö–∞—Ä—Ç–æ—á–∫–∏
        this.addEventListener('#card-ok', 'click', () => {
            this.hideCardModal();
        });

        // –Ø–∑—ã–∫
        this.addEventListener('#language-select', 'change', (e) => {
            this.changeLanguage(e.target.value);
        });

        // –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ (top-panel)
        this.addEventListener('#achievements-game-btn', 'click', () => {
            this.showAchievementsModal();
        });
        this.addEventListener('#statistics-game-btn', 'click', () => {
            this.showStatisticsModal();
        });
        this.addEventListener('#tournaments-game-btn', 'click', () => {
            this.showTournamentsModal();
        });
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä —Ç–æ–∫–µ–Ω–æ–≤
     */
    initializeTokenSelection() {
        const tokenOptions = document.querySelectorAll('.token-option');
        tokenOptions.forEach(option => {
            option.addEventListener('click', () => {
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
                tokenOptions.forEach(opt => opt.classList.remove('selected'));
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
                option.classList.add('selected');
            });
        });
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
     */
    initializePlayerCountSelection() {
        const playerCountSelect = document.getElementById('player-count');
        if (playerCountSelect) {
            playerCountSelect.addEventListener('change', (e) => {
                this.updatePlayerCount(parseInt(e.target.value));
            });
        }
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª
     */
    initializeRuleSettings() {
        const ruleCheckboxes = document.querySelectorAll('.rule-options input[type="checkbox"]');
        ruleCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                this.updateRuleSettings();
            });
        });
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
     */
    initializeModalHandlers() {
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        const modalOverlays = document.querySelectorAll('.modal-overlay');
        modalOverlays.forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    this.hideModal(overlay);
                }
            });
        });

        // –ö–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
        const closeButtons = document.querySelectorAll('.modal-close');
        closeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const modal = button.closest('.modal-overlay');
                this.hideModal(modal);
            });
        });

        // –ö–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã
        const cancelButtons = document.querySelectorAll('#modal-cancel');
        cancelButtons.forEach(button => {
            button.addEventListener('click', () => {
                const modal = button.closest('.modal-overlay');
                this.hideModal(modal);
            });
        });
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
     */
    initializeModals() {
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
        if (!document.getElementById('modal-overlay')) {
            this.createModalOverlay();
        }
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
     */
    createModalOverlay() {
        const modalHTML = `
            <div id="modal-overlay" class="modal-overlay hidden">
                <div class="modal">
                    <div class="modal-header">
                        <h3 id="modal-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-content" id="modal-content">
                        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
                    </div>
                    <div class="modal-footer">
                        <button id="modal-cancel" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
                        <button id="modal-confirm" class="btn primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–Ω–∏–º–∞—Ü–∏–∏
     */
    initializeAnimations() {
        // –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const buttons = document.querySelectorAll('.btn, .menu-btn');
        buttons.forEach(button => {
            button.addEventListener('mouseenter', () => {
                button.style.transform = 'translateY(-2px) scale(1.02)';
            });
            
            button.addEventListener('mouseleave', () => {
                button.style.transform = '';
            });
        });

        // –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫–ª–µ—Ç–æ–∫
        const cells = document.querySelectorAll('.corner-cell, .property-cell, .chance-cell, .treasure-cell, .tax-cell');
        cells.forEach(cell => {
            cell.addEventListener('mouseenter', () => {
                cell.style.transform = 'scale(1.05)';
                cell.style.zIndex = '5';
            });
            
            cell.addEventListener('mouseleave', () => {
                cell.style.transform = '';
                cell.style.zIndex = '';
            });
        });
    }

    /**
     * –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è
     * @param {string} selector - —Å–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
     * @param {string} event - —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
     * @param {Function} handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
     */
    addEventListener(selector, event, handler) {
        const element = document.querySelector(selector);
        if (element) {
            element.addEventListener(event, handler);
            this.eventListeners.push({ element, event, handler });
        }
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω
     * @param {string} screenName - –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
     */
    showScreen(screenName) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        Object.values(this.screens).forEach(screen => {
            if (screen) {
                screen.classList.remove('active');
                screen.classList.add('fade-out');
            }
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
        const targetScreen = this.screens[screenName];
        if (targetScreen) {
            setTimeout(() => {
                Object.values(this.screens).forEach(screen => {
                    if (screen) {
                        screen.classList.remove('fade-out');
                    }
                });
                targetScreen.classList.add('active');
                this.currentScreen = screenName;
            }, 300);
        }
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
     * @param {string} title - –∑–∞–≥–æ–ª–æ–≤–æ–∫
     * @param {string} content - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
     * @param {Function} onConfirm - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
     * @param {Function} onCancel - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–º–µ–Ω—ã
     */
    showModal(title, content, onConfirm = null, onCancel = null) {
        const modal = document.getElementById('modal-overlay');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const confirmBtn = document.getElementById('modal-confirm');
        const cancelBtn = document.getElementById('modal-cancel');

        if (modal && modalTitle && modalContent) {
            modalTitle.textContent = title;
            modalContent.innerHTML = content;
            modal.classList.remove('hidden');
            modal.classList.add('fade-in');
            const modalOverlay = document.querySelector('.modal-overlay');
            if (modalOverlay) {
                modalOverlay.classList.add('fade-in');
            }

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            const newConfirmBtn = confirmBtn.cloneNode(true);
            const newCancelBtn = cancelBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            if (onConfirm) {
                newConfirmBtn.addEventListener('click', () => {
                    onConfirm();
                    this.hideModal(modal);
                });
            }

            if (onCancel) {
                newCancelBtn.addEventListener('click', () => {
                    onCancel();
                    this.hideModal(modal);
                });
            }
        }
    }

    /**
     * –°–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
     * @param {Element} modal - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
     */
    hideModal(modal) {
        if (!modal) return;
        const overlay = modal.closest('.modal-overlay');
        modal.classList.remove('fade-in');
        modal.classList.add('fade-out');
        if (overlay) {
            overlay.classList.remove('fade-in');
            overlay.classList.add('fade-out');
        }
        setTimeout(() => {
            if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay);
            if (modal && modal.parentNode) modal.parentNode.removeChild(modal);
        }, 350);
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É
     * @param {string} title - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏
     * @param {string} text - —Ç–µ–∫—Å—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
     */
    showCard(title, text) {
        const cardModal = document.getElementById('card-modal');
        const cardTitle = document.getElementById('card-title');
        const cardText = document.getElementById('card-text');

        if (cardModal && cardTitle && cardText) {
            cardTitle.textContent = title;
            cardText.textContent = text;
            cardModal.classList.remove('hidden');
            cardModal.classList.add('fade-in');
        }
    }

    /**
     * –°–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É
     */
    hideCardModal() {
        const cardModal = document.querySelector('.card-modal');
        if (!cardModal) return;
        cardModal.classList.remove('fade-in');
        cardModal.classList.add('fade-out');
        setTimeout(() => {
            if (cardModal.parentNode) cardModal.parentNode.removeChild(cardModal);
        }, 350);
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
     * @param {string} message - —Å–æ–æ–±—â–µ–Ω–∏–µ
     * @param {string} type - —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
     * @param {number} duration - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
     */
    showNotification(message, type = 'info', duration = 3000) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        notification.style.cssText = `
            position: fixed;
            inset-block-start: 20px;
            inset-block-start: 20px;
            inset-inline-end: 20px;
            inset-inline-end: 20px;
            padding: 15px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            max-inline-size: 300px;
            max-inline-size: 300px;
            word-wrap: break-word;
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, duration);
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
     * @param {number} count - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
     */
    updatePlayerCount(count) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
        const playerList = document.querySelector('.player-list');
        if (playerList) {
            playerList.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.setAttribute('data-player', i + 1);
                playerItem.innerHTML = `
                    <img src="assets/tokens/matryoshka.png" alt="–¢–æ–∫–µ–Ω" class="player-token">
                    <div class="player-details">
                        <span class="player-name">–ò–≥—Ä–æ–∫ ${i + 1}</span>
                        <span class="player-money">2000‚ÇΩ</span>
                    </div>
                `;
                playerList.appendChild(playerItem);
            }
        }
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª
     */
    updateRuleSettings() {
        const settings = {
            auctionsEnabled: document.getElementById('auctions-enabled')?.checked || false,
            weatherEnabled: document.getElementById('weather-enabled')?.checked || false,
            economicEventsEnabled: document.getElementById('economic-events-enabled')?.checked || false,
            culturalEventsEnabled: document.getElementById('cultural-events-enabled')?.checked || false
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        saveToStorage('game_settings', settings);
    }

    /**
     * –ú–µ–Ω—è–µ—Ç —è–∑—ã–∫
     * @param {string} language - –∫–æ–¥ —è–∑—ã–∫–∞
     */
    changeLanguage(language) {
        // utils.setLocale(language); // utils.setLocale –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        this.updateAllTexts();
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä —è–∑—ã–∫–∞
        saveToStorage('language', language);
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
     */
    updateAllTexts() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
        const gameTitle = document.querySelector('.game-title');
        if (gameTitle) {
            gameTitle.textContent = '–†—É—Å—Å–∫–∞—è –ú–æ–Ω–æ–ø–æ–ª–∏—è';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
        const buttons = document.querySelectorAll('.menu-btn, .btn');
        buttons.forEach(button => {
            const key = button.getAttribute('data-text-key');
            if (key) {
                button.textContent = getText(key);
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        this.updateGameTexts();
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–≥—Ä–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã
     */
    updateGameTexts() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–µ—Ç–æ–∫
        const cells = document.querySelectorAll('.cell-content h3');
        cells.forEach(cell => {
            const position = cell.closest('[data-position]')?.getAttribute('data-position');
            if (position) {
                const cellData = board.getCell(parseInt(position));
                if (cellData) {
                    cell.textContent = cellData.name;
                }
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã
        const prices = document.querySelectorAll('.price');
        prices.forEach(price => {
            const position = price.closest('[data-position]')?.getAttribute('data-position');
            if (position) {
                const cellData = board.getCell(parseInt(position));
                if (cellData && cellData.price > 0) {
                    price.textContent = formatMoney(cellData.price);
                }
            }
        });
    }

    /**
     * –ë—Ä–æ—Å–∞–µ—Ç –∫–æ—Å—Ç–∏
     */
    rollDice() {
        const diceBtn = document.getElementById('dice-btn');
        if (diceBtn) {
            diceBtn.classList.add('rolling');
            diceBtn.disabled = true;
        }
        // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ –∏ –∑–≤—É–∫ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
        if (window.navigator && navigator.vibrate) {
            navigator.vibrate(80);
        }
        if (window.Audio) {
            try {
                const audio = new Audio('assets/sounds/dice.mp3');
                audio.volume = 0.5;
                audio.play();
            } catch (e) {}
        }
        // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–æ–≤
        let diceResultBlock = document.querySelector('.dice-result');
        if (diceResultBlock) {
            diceResultBlock.classList.remove('visible');
            diceResultBlock.classList.add('dice-rolling');
        }
        setTimeout(() => {
            const result = game.rollDice();
            this.showDiceResult(result);
            if (diceBtn) {
                diceBtn.classList.remove('rolling');
                diceBtn.disabled = false;
            }
            if (diceResultBlock) {
                diceResultBlock.classList.remove('dice-rolling');
                diceResultBlock.classList.add('visible');
            }
        }, 700);
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—Ä–æ—Å–∫–∞ –∫–æ—Å—Ç–µ–π
     * @param {Object} result - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—Ä–æ—Å–∫–∞
     */
    showDiceResult(result) {
        let diceResultBlock = document.querySelector('.dice-result');
        if (!diceResultBlock) {
            diceResultBlock = document.createElement('div');
            diceResultBlock.className = 'dice-result';
            document.body.appendChild(diceResultBlock);
        }
        diceResultBlock.innerHTML = `
            <div class="dice-numbers">
                <span class="dice">${result.dice1}</span>
                <span class="dice">${result.dice2}</span>
            </div>
        `;
        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        setTimeout(() => {
            diceResultBlock.classList.add('visible');
        }, 50);
    }

    /**
     * –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ö–æ–¥
     */
    endTurn() {
        game.nextPlayer();
        this.updateGameUI();
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ
     */
    showJoinGameDialog() {
        const content = `
            <div class="join-game-form">
                <div class="form-group">
                    <label for="game-code">–ö–æ–¥ –∏–≥—Ä—ã:</label>
                    <input type="text" id="game-code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–≥—Ä—ã">
                </div>
                <div class="form-group">
                    <label for="player-name">–í–∞—à–µ –∏–º—è:</label>
                    <input type="text" id="player-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                </div>
            </div>
        `;
        
        this.showModal('–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ', content, () => {
            const gameCode = document.getElementById('game-code')?.value;
            const playerName = document.getElementById('player-name')?.value;
            
            if (gameCode && playerName) {
                this.joinGame(gameCode, playerName);
            }
        });
    }

    /**
     * –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –∫ –∏–≥—Ä–µ
     * @param {string} gameCode - –∫–æ–¥ –∏–≥—Ä—ã
     * @param {string} playerName - –∏–º—è –∏–≥—Ä–æ–∫–∞
     */
    joinGame(gameCode, playerName) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –æ–Ω–ª–∞–π–Ω-–∏–≥—Ä–µ
        this.showNotification('–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –ø—Ä–∞–≤–∏–ª
     */
    showRulesDialog() {
        const content = `
            <div class="rules-content">
                <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h3>
                <div class="rules-section">
                    <h4>–¶–µ–ª—å –∏–≥—Ä—ã</h4>
                    <p>–°—Ç–∞—Ç—å —Å–∞–º—ã–º –±–æ–≥–∞—Ç—ã–º –∏–≥—Ä–æ–∫–æ–º, –ø–æ–∫—É–ø–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏ —Å–æ–±–∏—Ä–∞—è –∞—Ä–µ–Ω–¥–Ω—É—é –ø–ª–∞—Ç—É.</p>
                </div>
                <div class="rules-section">
                    <h4>–•–æ–¥ –∏–≥—Ä—ã</h4>
                    <ul>
                        <li>–ë—Ä–æ—Å—å—Ç–µ –∫–æ—Å—Ç–∏ –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∏—à–∫—É</li>
                        <li>–ü–æ–∫—É–ø–∞–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏</li>
                        <li>–ü–ª–∞—Ç–∏—Ç–µ –∞—Ä–µ–Ω–¥—É –∑–∞ —á—É–∂–∏–µ —É—á–∞—Å—Ç–∫–∏</li>
                        <li>–°—Ç—Ä–æ–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏</li>
                    </ul>
                </div>
                <div class="rules-section">
                    <h4>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
                    <ul>
                        <li>–†–µ–∑–∏–¥–µ–Ω—Ü–∏–∏ —É–¥–≤–∞–∏–≤–∞—é—Ç –∞—Ä–µ–Ω–¥–Ω—É—é –ø–ª–∞—Ç—É</li>
                        <li>–ü–æ–≥–æ–¥–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</li>
                        <li>–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω—è—é—Ç —Ü–µ–Ω—ã</li>
                        <li>–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–∞—é—Ç –±–æ–Ω—É—Å—ã</li>
                    </ul>
                </div>
            </div>
        `;
        
        this.showModal('–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã', content);
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Ç–æ—Ä–≥–æ–≤–ª–∏
     */
    showTradeDialog() {
        const currentPlayer = game.players[game.currentPlayerIndex];
        if (!currentPlayer) return;
        
        const content = `
            <div class="trade-dialog">
                <h3>–¢–æ—Ä–≥–æ–≤–ª—è</h3>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –æ–±–º–µ–Ω.</p>
                <div class="trade-form">
                    <select id="trade-partner">
                        ${game.players.filter(p => p.id !== currentPlayer.id && !p.bankrupt)
                            .map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                    </select>
                </div>
            </div>
        `;
        
        this.showModal('–¢–æ—Ä–≥–æ–≤–ª—è', content, () => {
            this.showNotification('–§—É–Ω–∫—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        });
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∑–∞–ª–æ–≥–∞
     */
    showMortgageDialog() {
        const currentPlayer = game.players[game.currentPlayerIndex];
        if (!currentPlayer) return;
        
        const mortgagedProperties = currentPlayer.getMortgagedProperties();
        const unmortgagedProperties = currentPlayer.getUnmortgagedProperties();
        
        const content = `
            <div class="mortgage-dialog">
                <h3>–ó–∞–ª–æ–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h3>
                <div class="mortgage-options">
                    <div class="mortgage-section">
                        <h4>–ó–∞–ª–æ–∂–∏—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h4>
                        ${unmortgagedProperties.map(pos => {
                            const cell = board.getCell(pos);
                            return `<div class="property-option">
                                <input type="radio" name="mortgage" value="${pos}">
                                <label>${cell.name} - ${formatMoney(cell.price / 2)}</label>
                            </div>`;
                        }).join('')}
                    </div>
                    <div class="mortgage-section">
                        <h4>–í—ã–∫—É–ø–∏—Ç—å –∏–∑ –∑–∞–ª–æ–≥–∞</h4>
                        ${mortgagedProperties.map(pos => {
                            const cell = board.getCell(pos);
                            return `<div class="property-option">
                                <input type="radio" name="unmortgage" value="${pos}">
                                <label>${cell.name} - ${formatMoney(cell.price / 2 * 1.1)}</label>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            </div>
        `;
        
        this.showModal('–ó–∞–ª–æ–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏', content, () => {
            this.showNotification('–§—É–Ω–∫—Ü–∏—è –∑–∞–ª–æ–≥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        });
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
     */
    showBuildDialog() {
        const currentPlayer = game.players[game.currentPlayerIndex];
        if (!currentPlayer) return;
        
        const buildableProperties = currentPlayer.properties.filter(pos => {
            const cell = board.getCell(pos);
            return cell && !cell.mortgaged && board.hasColorMonopoly(cell.color, currentPlayer.id);
        });
        
        const content = `
            <div class="build-dialog">
                <h3>–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</h3>
                <div class="build-options">
                    ${buildableProperties.map(pos => {
                        const cell = board.getCell(pos);
                        return `<div class="build-option">
                            <h4>${cell.name}</h4>
                            <p>–£–ª—É—á—à–µ–Ω–∏—è: ${cell.improvements}/${CONFIG.IMPROVEMENT.MAX_LEVEL}</p>
                            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è: ${formatMoney(CONFIG.IMPROVEMENT.COST_PER_LEVEL)}</p>
                            <button onclick="ui.buildImprovement(${pos})" ${cell.improvements >= CONFIG.IMPROVEMENT.MAX_LEVEL ? 'disabled' : ''}>
                                –î–æ–±–∞–≤–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ
                            </button>
                        </div>`;
                    }).join('')}
                </div>
            </div>
        `;
        
        this.showModal('–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ', content);
    }

    /**
     * –î–æ–±–∞–≤–ª—è–µ—Ç —É–ª—É—á—à–µ–Ω–∏–µ
     * @param {number} position - –ø–æ–∑–∏—Ü–∏—è —Å–≤–æ–π—Å—Ç–≤–∞
     */
    buildImprovement(position) {
        const currentPlayer = game.players[game.currentPlayerIndex];
        if (currentPlayer && currentPlayer.addImprovement(position)) {
            this.showNotification('–£–ª—É—á—à–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!', 'success');
            this.updateGameUI();
        } else {
            this.showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ', 'error');
        }
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∞—É–∫—Ü–∏–æ–Ω–∞
     */
    showAuctionDialog() {
        const content = `
            <div class="auction-dialog">
                <h3>–ê—É–∫—Ü–∏–æ–Ω—ã</h3>
                <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∞–∫—Ç–∏–≤–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã.</p>
                <p>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤.</p>
            </div>
        `;
        
        this.showModal('–ê—É–∫—Ü–∏–æ–Ω—ã', content);
    }

    /**
     * –ù–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä—É
     */
    startGame() {
        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const playerCount = parseInt(document.getElementById('player-count')?.value || 4);
        const selectedTokens = document.querySelectorAll('.token-option.selected');
        
        if (selectedTokens.length !== playerCount) {
            this.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤', 'error');
            return;
        }
        
        // –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–æ–≤
        const playerData = [];
        for (let i = 0; i < playerCount; i++) {
            const token = selectedTokens[i]?.getAttribute('data-token') || 'matryoshka';
            playerData.push({
                id: i + 1,
                name: `–ò–≥—Ä–æ–∫ ${i + 1}`,
                token: `assets/tokens/${token}.png`
            });
        }
        
        // –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É
        game.startNewGame(playerData);
        this.showScreen('game-screen');
        this.updateGameUI();
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
     */
    updateGameUI() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
        game.players.forEach(player => {
            player.updateMoneyDisplay();
            player.updateTokenPosition();
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        game.updateCurrentPlayerDisplay();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
        game.updateWeatherDisplay();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        game.updateEventsDisplay();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∞—Ç–∞
        game.updateChatDisplay();
    }

    /**
     * –û—á–∏—â–∞–µ—Ç –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
     */
    cleanup() {
        this.eventListeners.forEach(({ element, event, handler }) => {
            element.removeEventListener(event, handler);
        });
        this.eventListeners = [];
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
     */
    showAchievementsModal() {
        try {
            if (!achievements) {
                this.showNotification('–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'error');
                return;
            }
            const player = game?.players?.[game.currentPlayerIndex];
            let playerAchievements = player ? achievements.getPlayerAchievements(player) : [];
            if (!Array.isArray(playerAchievements)) throw new Error('Achievements data corrupted');
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
            const rarities = ['all', 'common', 'rare', 'epic', 'secret'];
            let selectedRarity = this._achievementsRarityFilter || 'all';
            if (selectedRarity !== 'all') {
                playerAchievements = playerAchievements.filter(a => a.rarity === selectedRarity);
            }
            const total = achievements.achievements.size;
            const unlocked = playerAchievements.filter(a => a.unlocked).length;
            const percent = total ? Math.round(unlocked / total * 100) : 0;
            const filterButtons = rarities.map(r => `<button class=\"btn secondary${selectedRarity === r ? ' active' : ''}\" data-rarity=\"${r}\">${r === 'all' ? '–í—Å–µ' : r.charAt(0).toUpperCase() + r.slice(1)}</button>`).join(' ');
            // SVG Pie chart
            const radius = 32, stroke = 8, circ = 2 * Math.PI * radius, offset = circ * (1 - percent / 100);
            const pieChart = `<svg width='80' height='80' style='display:block;margin:0 auto 8px;'><circle r='${radius}' cx='40' cy='40' fill='none' stroke='#eee' stroke-width='${stroke}'/><circle r='${radius}' cx='40' cy='40' fill='none' stroke='#4caf50' stroke-width='${stroke}' stroke-dasharray='${circ}' stroke-dashoffset='${offset}' style='transition:stroke-dashoffset 0.5s;'/><text x='40' y='46' text-anchor='middle' font-size='1.2em' fill='#333'>${percent}%</text></svg>`;
            const content = `
                <div class=\"achievements-modal\">
                    <h3>${getText('ACHIEVEMENTS_TITLE')}</h3>
                    <div style=\"margin-block-end:12px;\">
                        <div style=\"display:flex;align-items:center;flex-direction:column;\">${pieChart}</div>
                        <div style=\"font-size:0.95em; margin-block-end:4px;\">${unlocked} / ${total} (${percent}%) ${getText('ACHIEVEMENTS_UNLOCKED') || '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'}</div>
                        <div style=\"background:#eee; border-radius:6px; block-size:10px; inline-size:100%; overflow:hidden; margin-block-end:8px;\">
                            <div style=\"background:#4caf50; inline-size:${percent}%; inline-size:${percent}%; block-size:100%;\"></div>
                        </div>
                        <div class=\"achievements-filters\" style=\"margin-block-end:8px;\">${filterButtons}</div>
                    </div>
                    <ul class=\"achievements-list\">
                        ${playerAchievements.length ? playerAchievements.map(a => `
                            <li class=\"achievement ${a.unlocked ? 'unlocked' : 'locked'}\">\n                                <span class=\"icon\">${a.icon || 'üèÜ'}</span>\n                                <span class=\"title\">${a.title || a.name}</span>\n                                <span class=\"desc\">${a.message || a.description}</span>\n                                <span class=\"date\">${a.unlocked ? (new Date(a.unlockedAt)).toLocaleDateString() : ''}</span>\n                            </li>
                        `).join('') : `<li>${getText('ACHIEVEMENTS_NONE')}</li>`}
                    </ul>
                </div>
                <script>
                    document.querySelectorAll('.achievements-filters button').forEach(btn => {
                        btn.onclick = function() {
                            ui._achievementsRarityFilter = this.getAttribute('data-rarity');
                            ui.showAchievementsModal();
                        };
                    });
                </script>
            `;
            this.showModal(getText('ACHIEVEMENTS_TITLE'), content);
        } catch (e) {
            this.showNotification('–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π: ' + (e.message || e), 'error');
        }
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
     */
    showStatisticsModal() {
        try {
            if (!statistics) {
                this.showNotification('–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'error');
                return;
            }
            const player = game?.players?.[game.currentPlayerIndex];
            const stats = player ? statistics.getPlayerStats(player.id) : null;
            const globalStats = statistics.getGlobalStats ? statistics.getGlobalStats() : null;
            const records = statistics.getRecords ? statistics.getRecords() : null;
            const tabs = [
                { key: 'player', label: '–ò–≥—Ä–æ–∫–∞' },
                { key: 'global', label: '–ì–ª–æ–±–∞–ª—å–Ω–∞—è' },
                { key: 'records', label: '–†–µ–∫–æ—Ä–¥—ã' }
            ];
            let selectedTab = this._statisticsTab || 'player';
            const tabButtons = tabs.map(tab => `<button class="btn secondary${selectedTab === tab.key ? ' active' : ''}" data-tab="${tab.key}">${tab.label}</button>`).join(' ');
            let contentTab = '';
            if (selectedTab === 'player') {
                contentTab = stats ? `
                    <ul class="statistics-list">
                        <li>${getText('STATISTICS.GAMES_PLAYED')}: ${stats.gamesPlayed}</li>
                        <li>${getText('STATISTICS.GAMES_WON')}: ${stats.gamesWon}</li>
                        <li>${getText('STATISTICS.TOTAL_MONEY')}: ${stats.totalMoneyEarned}‚ÇΩ</li>
                        <li>${getText('STATISTICS.TOTAL_PROPERTIES')}: ${stats.totalPropertiesPurchased}</li>
                        <li>${getText('STATISTICS.TOTAL_TRADES')}: ${stats.totalTradesCompleted}</li>
                        <li>${getText('STATISTICS.TOTAL_AUCTIONS')}: ${stats.totalAuctionsWon}</li>
                        <li>${getText('STATISTICS.ACHIEVEMENTS_UNLOCKED')}: ${stats.totalAchievementsUnlocked || 0}</li>
                        <li>${getText('STATISTICS.TIME_PLAYED')}: ${stats.totalPlayTime || 0}</li>
                    </ul>
                ` : `<div>${getText('STATISTICS_NONE')}</div>`;
            } else if (selectedTab === 'global') {
                contentTab = globalStats ? `
                    <ul class="statistics-list">
                        <li>${getText('STATISTICS.GAMES_PLAYED')}: ${globalStats.totalGames}</li>
                        <li>${getText('STATISTICS.TOTAL_MONEY')}: ${globalStats.totalMoneyEarned}‚ÇΩ</li>
                        <li>${getText('STATISTICS.TOTAL_PROPERTIES')}: ${globalStats.totalPropertiesPurchased}</li>
                        <li>${getText('STATISTICS.TOTAL_TRADES')}: ${globalStats.totalTradesCompleted}</li>
                        <li>${getText('STATISTICS.TOTAL_AUCTIONS')}: ${globalStats.totalAuctionsWon}</li>
                        <li>${getText('STATISTICS.TIME_PLAYED')}: ${globalStats.totalPlayTime || 0}</li>
                    </ul>
                ` : `<div>${getText('STATISTICS_NONE')}</div>`;
            } else if (selectedTab === 'records') {
                contentTab = records ? `
                    <ul class="statistics-list">
                        ${Array.from(records.entries()).map(([key, rec]) => `<li>${getText('STATISTICS.'+key.toUpperCase()) || key}: ${rec.value} (${rec.player || ''})</li>`).join('')}
                    </ul>
                ` : `<div>${getText('STATISTICS_NONE')}</div>`;
            }
            const content = `
                <div class="statistics-modal">
                    <h3>${getText('STATISTICS_TITLE')}</h3>
                    <div class="statistics-tabs" style="margin-block-end:12px;">${tabButtons}</div>
                    <div class="statistics-tab-content">${contentTab}</div>
                </div>
                <script>
                    document.querySelectorAll('.statistics-tabs button').forEach(btn => {
                        btn.onclick = function() {
                            ui._statisticsTab = this.getAttribute('data-tab');
                            ui.showStatisticsModal();
                        };
                    });
                </script>
            `;
            this.showModal(getText('STATISTICS_TITLE'), content);
        } catch (e) {
            this.showNotification('–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + (e.message || e), 'error');
        }
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤
     */
    showTournamentsModal() {
        try {
            if (!tournaments) {
                this.showNotification('–°–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'error');
                return;
            }
            const tabs = [
                { key: 'active', label: '–ê–∫—Ç–∏–≤–Ω—ã–µ' },
                { key: 'history', label: '–ò—Å—Ç–æ—Ä–∏—è' },
                { key: 'rankings', label: '–†–µ–π—Ç–∏–Ω–≥' }
            ];
            let selectedTab = this._tournamentsTab || 'active';
            const tabButtons = tabs.map(tab => `<button class="btn secondary${selectedTab === tab.key ? ' active' : ''}" data-tab="${tab.key}">${tab.label}</button>`).join(' ');
            let contentTab = '';
            if (selectedTab === 'active') {
                const activeTournaments = tournaments.getActiveTournaments();
                contentTab = `<ul class="tournaments-list">
                    ${activeTournaments.length ? activeTournaments.map(t => `
                        <li class="tournament">
                            <span class="name">${t.name}</span>
                            <span class="type">–¢–∏–ø: ${t.type}</span>
                            <span class="status">–°—Ç–∞—Ç—É—Å: ${t.status}</span>
                            <span class="players">–ò–≥—Ä–æ–∫–æ–≤: ${t.currentPlayers?.length || 0}/${t.maxPlayers}</span>
                        </li>
                    `).join('') : `<li>${getText('TOURNAMENTS_NONE')}</li>`}
                </ul>`;
            } else if (selectedTab === 'history') {
                const history = tournaments.getTournamentHistory ? tournaments.getTournamentHistory(10) : [];
                contentTab = `<ul class="tournaments-list">
                    ${history.length ? history.map(t => `
                        <li class="tournament">
                            <span class="name">${t.name}</span>
                            <span class="type">–¢–∏–ø: ${t.type}</span>
                            <span class="status">–°—Ç–∞—Ç—É—Å: ${t.status}</span>
                            <span class="players">–ò–≥—Ä–æ–∫–æ–≤: ${t.currentPlayers?.length || 0}/${t.maxPlayers}</span>
                            <span class="winner">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${t.winner || '-'}</span>
                        </li>
                    `).join('') : `<li>–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤</li>`}
                </ul>`;
            } else if (selectedTab === 'rankings') {
                const rankings = tournaments.getRankings ? tournaments.getRankings(10) : [];
                contentTab = `<ul class="tournaments-list">
                    ${rankings.length ? rankings.map(r => `
                        <li class="tournament">
                            <span class="name">${r.playerName || r.player || '-'}</span>
                            <span class="type">–û—á–∫–∏: ${r.points || 0}</span>
                            <span class="status">–ü–æ–±–µ–¥: ${r.tournamentsWon || r.wins || 0}</span>
                        </li>
                    `).join('') : `<li>–ù–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞</li>`}
                </ul>`;
            }
            const content = `
                <div class="tournaments-modal">
                    <h3>${getText('TOURNAMENTS_TITLE')}</h3>
                    <div class="tournaments-tabs" style="margin-block-end:12px;">${tabButtons}</div>
                    <div class="tournaments-tab-content">${contentTab}</div>
                </div>
                <script>
                    document.querySelectorAll('.tournaments-tabs button').forEach(btn => {
                        btn.onclick = function() {
                            ui._tournamentsTab = this.getAttribute('data-tab');
                            ui.showTournamentsModal();
                        };
                    });
                </script>
            `;
            this.showModal(getText('TOURNAMENTS_TITLE'), content);
        } catch (e) {
            this.showNotification('–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–æ–≤: ' + (e.message || e), 'error');
        }
    }

    // DEBUG: —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ APP_CONFIG.DEBUG_MODE)
    addDebugTestButtons() {
        if (!(window.APP_CONFIG && APP_CONFIG.DEBUG_MODE)) return;
        const panel = document.createElement('div');
        panel.style.position = 'fixed';
        panel.style.bottom = '16px';
        panel.style.right = '16px';
        panel.style.zIndex = 30000;
        panel.style.background = '#fff';
        panel.style.border = '1px solid #ccc';
        panel.style.borderRadius = '8px';
        panel.style.padding = '8px 12px';
        panel.style.boxShadow = '0 2px 8px rgba(0,0,0,0.12)';
        panel.innerHTML = `
            <button onclick="if(window.achievements){achievements.showAchievementNotification({icon:'üèÜ',name:'–¢–µ—Å—Ç',description:'–¢–µ—Å—Ç–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ',points:10,rarity:'epic'})}">–¢–µ—Å—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</button>
            <button onclick="if(window.ui){ui.showNotification('–¢–µ—Å—Ç —Ä–µ–∫–æ—Ä–¥ <button class=\\'notification-details\\' onclick=\\'window.ui.showStatisticsModal()\\'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>','success',5000)}">–¢–µ—Å—Ç —Ä–µ–∫–æ—Ä–¥</button>
            <button onclick="if(window.ui){ui.showNotification('–¢–µ—Å—Ç —Ç—É—Ä–Ω–∏—Ä <button class=\\'notification-details\\' onclick=\\'window.ui.showTournamentsModal()\\'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>','success',5000)}">–¢–µ—Å—Ç —Ç—É—Ä–Ω–∏—Ä</button>
        `;
        document.body.appendChild(panel);
    }
}

// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä UI
const ui = new UI();

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
if (typeof module !== 'undefined' && module.exports) {
    module.exports = UI;
} 

/**
 * –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É (40 –∫–ª–µ—Ç–æ–∫), —Å –ª–æ–≥–æ—Ç–∏–ø–∞–º–∏, —Ü–≤–µ—Ç–∞–º–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
 */
function renderBoard() {
    const boardContainer = document.querySelector('.game-board');
    if (!boardContainer) return;
    boardContainer.innerHTML = '';

    // –°–æ–∑–¥–∞—ë–º —Å–µ—Ç–∫—É 11x11 (81 —è—á–µ–π–∫–∞, 40 –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É)
    const size = 11;
    const boardGrid = document.createElement('div');
    boardGrid.className = 'board-grid';
    boardGrid.style.display = 'grid';
    boardGrid.style.gridTemplateRows = `repeat(${size}, 1fr)`;
    boardGrid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
    boardGrid.style.width = '100%';
    boardGrid.style.height = '100%';
    boardGrid.style.position = 'relative';

    // –ú–∞—Å—Å–∏–≤ –ø–æ–∑–∏—Ü–∏–π –∫–ª–µ—Ç–æ–∫ –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É (–ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ)
    const positions = [];
    for (let i = 0; i < size; i++) positions.push(i); // –≤–µ—Ä—Ö
    for (let i = 1; i < size - 1; i++) positions.push(size - 1 + i * (size - 1)); // –ø—Ä–∞–≤—ã–π
    for (let i = size - 2; i >= 0; i--) positions.push((size * (size - 1)) + i); // –Ω–∏–∑
    for (let i = size - 2; i > 0; i--) positions.push(i * size); // –ª–µ–≤—ã–π

    // –ü–æ–ª—É—á–∞–µ–º –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é —Ç—É–ª—Ç–∏–ø–æ–≤
    const tooltips = (CONFIG && CONFIG.TOOLTIPS) || {};

    // –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ —Å–æ–∑–¥–∞—ë–º –∫–ª–µ—Ç–∫—É
    for (let idx = 0; idx < 40; idx++) {
        const cell = board.getCell(idx);
        const pos = positions[idx];
        const row = Math.floor(pos / size) + 1;
        const col = (pos % size) + 1;
        const cellDiv = document.createElement('div');
        cellDiv.classList.add('board-cell');
        cellDiv.style.gridRow = row;
        cellDiv.style.gridColumn = col;
        cellDiv.setAttribute('data-cell-idx', idx);
        cellDiv.setAttribute('data-cell-type', cell.type);

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç—É–ª—Ç–∏–ø –¥–ª—è —Ç–∏–ø–∞ –∫–ª–µ—Ç–∫–∏
        let tooltipText = '';
        switch (cell.type) {
            case 'property':
                tooltipText = `${tooltips.PROPERTY_INFO || '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å'}: ${cell.name}\n–¶–µ–Ω–∞: ${cell.price}‚ÇΩ\n–ê—Ä–µ–Ω–¥–∞: ${cell.rent || '-'}‚ÇΩ`;
                break;
            case 'chance':
                tooltipText = tooltips.CHANCE || '–®–∞–Ω—Å: –ø–æ–ª—É—á–∏—Ç–µ —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ';
                break;
            case 'tax':
                tooltipText = tooltips.TAX || '–ù–∞–ª–æ–≥: –∑–∞–ø–ª–∞—Ç–∏—Ç–µ –Ω–∞–ª–æ–≥';
                break;
            case 'jail':
                tooltipText = tooltips.JAIL || '–¢—é—Ä—å–º–∞: –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–µ—â–µ–Ω–∏–µ';
                break;
            case 'free_parking':
                tooltipText = tooltips.FREE_PARKING || '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞';
                break;
            case 'go_to_jail':
                tooltipText = tooltips.GO_TO_JAIL || '–ò–¥–∏—Ç–µ –≤ —Ç—é—Ä—å–º—É!';
                break;
            case 'treasure':
                tooltipText = tooltips.TREASURE || '–ö–∞–∑–Ω–∞: –ø–æ–ª—É—á–∏—Ç–µ –∏–ª–∏ –ø–æ—Ç–µ—Ä—è–π—Ç–µ –¥–µ–Ω—å–≥–∏';
                break;
            case 'start':
                tooltipText = tooltips.START || '–°—Ç–∞—Ä—Ç: –ø–æ–ª—É—á–∏—Ç–µ –¥–µ–Ω—å–≥–∏ –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏';
                break;
            default:
                tooltipText = cell.name;
        }
        cellDiv.setAttribute('data-tooltip', tooltipText);

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É/—Ü–≤–µ—Ç –¥–ª—è —Ç—É–ª—Ç–∏–ø–∞
        let tooltipIcon = '';
        let tooltipColor = '';
        switch (cell.type) {
            case 'property':
                tooltipColor = cell.color || '#888';
                break;
            case 'chance':
                tooltipIcon = 'üé≤';
                break;
            case 'tax':
                tooltipIcon = 'üí∏';
                break;
            case 'jail':
                tooltipIcon = 'üöî';
                break;
            case 'free_parking':
                tooltipIcon = 'üÖøÔ∏è';
                break;
            case 'go_to_jail':
                tooltipIcon = '‚û°Ô∏èüöî';
                break;
            case 'treasure':
                tooltipIcon = 'üí∞';
                break;
            case 'start':
                tooltipIcon = 'üèÅ';
                break;
            default:
                tooltipIcon = '';
        }

        // –£–≥–ª–æ–≤—ã–µ –∫–ª–µ—Ç–∫–∏
        if ([0, 10, 20, 30].includes(idx)) {
            cellDiv.classList.add('corner-cell');
            cellDiv.innerHTML = `<div class="cell-content"><h3>${cell.name}</h3></div>`;
        } else if (cell.type === 'property') {
            // –ö–ª–µ—Ç–∫–∏-—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
            cellDiv.classList.add('property-cell');
            if (cell.color) cellDiv.setAttribute('data-color', cell.color);
            let logoHtml = '';
            if (cell.logo) {
                if (typeof cell.logo === 'string' && (cell.logo.endsWith('.svg') || cell.logo.endsWith('.png'))) {
                    logoHtml = `<img src="${cell.logo}" alt="logo" class="property-logo-img">`;
                } else {
                    logoHtml = cell.logo;
                }
            }
            let ownerHtml = '';
            let improvementsHtml = '';
            // –¢–µ—Å—Ç–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ (idx % 4)
            const ownerColors = ['#e53935', '#1e88e5', '#43a047', '#fbc02d'];
            if (cell.owner !== null && cell.owner !== undefined) {
                const color = ownerColors[cell.owner % ownerColors.length];
                ownerHtml = `<span class="property-owner" style="background:${color}"></span>`;
            }
            if (cell.improvements && cell.improvements > 0) {
                for (let i = 0; i < cell.improvements; i++) {
                    improvementsHtml += '<span class="property-improvement">üè†</span>';
                }
            }
            cellDiv.innerHTML = `
                <div class="cell-content">
                    <div class="property-color" style="background:${cell.color}"></div>
                    <div class="property-logo">${logoHtml}</div>
                    <h3>${cell.name}</h3>
                    <p class="price">${cell.price}‚ÇΩ</p>
                    <div class="property-extras">${ownerHtml}${improvementsHtml}</div>
                </div>
            `;
        } else if (cell.type === 'chance') {
            cellDiv.classList.add('chance-cell');
            cellDiv.innerHTML = `<div class="cell-content"><span>?</span><h3>–®–ê–ù–°</h3></div>`;
        } else if (cell.type === 'treasure') {
            cellDiv.classList.add('treasure-cell');
            cellDiv.innerHTML = `<div class="cell-content"><span>üí∞</span><h3>–ö–ê–ó–ù–ê</h3></div>`;
        } else if (cell.type === 'tax') {
            cellDiv.classList.add('tax-cell');
            cellDiv.innerHTML = `<div class="cell-content"><span>üí∏</span><h3>–ù–ê–õ–û–ì</h3></div>`;
        } else if (cell.type === 'jail') {
            cellDiv.classList.add('corner-cell', 'jail');
            cellDiv.innerHTML = `<div class="cell-content"><span>üöî</span><h3>–¢–Æ–†–¨–ú–ê</h3></div>`;
        } else if (cell.type === 'free_parking') {
            cellDiv.classList.add('corner-cell', 'free-parking');
            cellDiv.innerHTML = `<div class="cell-content"><span>üÖøÔ∏è</span><h3>–ü–ê–†–ö–û–í–ö–ê</h3></div>`;
        } else if (cell.type === 'go_to_jail') {
            cellDiv.classList.add('corner-cell', 'go-to-jail');
            cellDiv.innerHTML = `<div class="cell-content"><span>‚û°Ô∏èüöî</span><h3>–í –¢–Æ–†–¨–ú–£</h3></div>`;
        } else {
            cellDiv.innerHTML = `<div class="cell-content"><h3>${cell.name}</h3></div>`;
        }

        // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        cellDiv.addEventListener('click', () => {
            let modalTitle = cell.name;
            let modalContent = '';
            switch (cell.type) {
                case 'property':
                    modalContent = `<div><b>–¶–µ–Ω–∞:</b> ${cell.price}‚ÇΩ<br><b>–ê—Ä–µ–Ω–¥–∞:</b> ${cell.rent || '-'}‚ÇΩ<br><b>–í–ª–∞–¥–µ–ª–µ—Ü:</b> ${cell.owner !== null ? '–ò–≥—Ä–æ–∫ ' + (cell.owner + 1) : '–Ω–µ—Ç'}<br><b>–£–ª—É—á—à–µ–Ω–∏—è:</b> ${cell.improvements || 0}</div>`;
                    if (cell.owner === null) {
                        modalContent += `<button class='btn primary' onclick='game.buyProperty(${idx})'>–ö—É–ø–∏—Ç—å</button>`;
                    } else if (cell.owner !== game.currentPlayerIndex) {
                        modalContent += `<button class='btn primary' onclick='game.payRent(${idx})'>–û–ø–ª–∞—Ç–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>`;
                    } else {
                        modalContent += `<button class='btn secondary' onclick='ui.showBuildDialog()'>–£–ª—É—á—à–∏—Ç—å</button>`;
                    }
                    break;
                case 'chance':
                    modalContent = `<div>–í—ã—Ç—è–Ω–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –®–∞–Ω—Å!</div>`;
                    break;
                case 'tax':
                    modalContent = `<div>–ó–∞–ø–ª–∞—Ç–∏—Ç–µ –Ω–∞–ª–æ–≥!</div>`;
                    break;
                case 'jail':
                    modalContent = `<div>–¢—é—Ä—å–º–∞. –ü—Ä–æ—Å—Ç–æ –ø–æ—Å–µ—â–µ–Ω–∏–µ.</div>`;
                    break;
                case 'free_parking':
                    modalContent = `<div>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞. –û—Ç–¥–æ—Ö–Ω–∏—Ç–µ!</div>`;
                    break;
                case 'go_to_jail':
                    modalContent = `<div>–í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å –≤ —Ç—é—Ä—å–º—É!</div>`;
                    break;
                case 'treasure':
                    modalContent = `<div>–ö–∞–∑–Ω–∞. –ü–æ–ª—É—á–∏—Ç–µ –∏–ª–∏ –ø–æ—Ç–µ—Ä—è–π—Ç–µ –¥–µ–Ω—å–≥–∏!</div>`;
                    break;
                case 'start':
                    modalContent = `<div>–°—Ç–∞—Ä—Ç. –ü–æ–ª—É—á–∏—Ç–µ –¥–µ–Ω—å–≥–∏ –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏!</div>`;
                    break;
                default:
                    modalContent = `<div>${cell.name}</div>`;
            }
            ui.showModal(modalTitle, modalContent);
        });

        // –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç—É–ª—Ç–∏–ø
        cellDiv.addEventListener('mouseenter', (e) => {
            showCustomTooltip(cellDiv, {
                text: tooltipText,
                type: cell.type,
                color: tooltipColor,
                icon: tooltipIcon
            }, e);
        });
        cellDiv.addEventListener('mouseleave', hideCustomTooltip);
        // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî –ø–æ —Ç–∞–ø—É
        cellDiv.addEventListener('touchstart', (e) => {
            showCustomTooltip(cellDiv, {
                text: tooltipText,
                type: cell.type,
                color: tooltipColor,
                icon: tooltipIcon
            }, e);
        });
        cellDiv.addEventListener('touchend', hideCustomTooltip);

        boardGrid.appendChild(cellDiv);
    }

    // –¶–µ–Ω—Ç—Ä –¥–æ—Å–∫–∏ ‚Äî –ø—É—Å—Ç–æ–π div –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏/–≤–∏–¥–∂–µ—Ç–æ–≤
    const centerDiv = document.createElement('div');
    centerDiv.className = 'board-center';
    centerDiv.style.gridRow = '2 / span 9';
    centerDiv.style.gridColumn = '2 / span 9';
    boardGrid.appendChild(centerDiv);

    boardContainer.appendChild(boardGrid);
}

// –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç—É–ª—Ç–∏–ø
function showCustomTooltip(target, opts, event) {
    hideCustomTooltip();
    const tooltip = document.createElement('div');
    tooltip.className = 'custom-tooltip';
    let iconHtml = '';
    if (opts.type === 'property' && opts.color) {
        iconHtml = `<span class="custom-tooltip__color" style="background:${opts.color}"></span>`;
    } else if (opts.icon) {
        iconHtml = `<span class="custom-tooltip__icon">${opts.icon}</span>`;
    }
    tooltip.innerHTML = `${iconHtml}<span class="custom-tooltip__text">${opts.text.replace(/\n/g, '<br>')}</span>`;
    document.body.appendChild(tooltip);
    // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    const rect = target.getBoundingClientRect();
    // –°–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–µ–º –≤–∏–¥–∏–º—ã–º, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –≤—ã—Å–æ—Ç—É
    tooltip.style.left = rect.left + window.scrollX + rect.width / 2 + 'px';
    tooltip.style.insetInlineStart = rect.left + window.scrollX + rect.width / 2 + 'px';
    tooltip.style.top = rect.top + window.scrollY - tooltip.offsetHeight - 8 + 'px';
    tooltip.style.insetBlockStart = rect.top + window.scrollY - tooltip.offsetHeight - 8 + 'px';
    tooltip.style.transform = 'translate(-50%, -100%)';
    tooltip.style.opacity = '1';
    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –µ—Å–ª–∏ —Ç—É–ª—Ç–∏–ø –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —ç–∫—Ä–∞–Ω
    const tRect = tooltip.getBoundingClientRect();
    if (tRect.left < 4) {
        tooltip.style.left = (rect.left + window.scrollX + tRect.width / 2 + 8) + 'px';
        tooltip.style.insetInlineStart = (rect.left + window.scrollX + tRect.width / 2 + 8) + 'px';
    }
    if (tRect.right > window.innerWidth - 4) {
        tooltip.style.left = (rect.right + window.scrollX - tRect.width / 2 - 8) + 'px';
        tooltip.style.insetInlineStart = (rect.right + window.scrollX - tRect.width / 2 - 8) + 'px';
    }
    if (tRect.top < 4) {
        tooltip.style.top = (rect.top + window.scrollY + rect.height + 8) + 'px';
        tooltip.style.insetBlockStart = (rect.top + window.scrollY + rect.height + 8) + 'px';
        tooltip.style.transform = 'translate(-50%, 0)';
    }
    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî –∞–≤—Ç–æ–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
    if (event && event.type && event.type.startsWith('touch')) {
        setTimeout(hideCustomTooltip, 2000);
    }
}
function hideCustomTooltip() {
    const tooltip = document.querySelector('.custom-tooltip');
    if (tooltip) tooltip.remove();
} 

function showToast(message, type = 'info', duration = 2500) {
  const toast = document.getElementById('toast');
  if (!toast) return;
  toast.textContent = message;
  toast.className = 'toast show ' + type;
  setTimeout(() => {
    toast.classList.remove('show');
  }, duration);
}
// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// showToast('–í—ã –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å!', 'success');
// showToast('–•–æ–¥ –∑–∞–≤–µ—Ä—à—ë–Ω!', 'info'); 
```

